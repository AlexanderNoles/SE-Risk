<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>World Conquest: Assets/Mirror/Components/NetworkTransform/NetworkTransformReliable.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">World Conquest
   </div>
   <div id="projectbrief">Implementation of the Risk board game for our Software Engineering module.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_network_transform_reliable_8cs_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">NetworkTransformReliable.cs</div></div>
</div><!--header-->
<div class="contents">
<a href="_network_transform_reliable_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// NetworkTransform V3 (reliable) by mischa (2022-10)</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">using </span>System.Collections.Generic;</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">using </span>System.Runtime.CompilerServices;</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">using </span>UnityEngine;</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span> </div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespace_mirror.html">Mirror</a></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span>{</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>    [AddComponentMenu(<span class="stringliteral">&quot;Network/Network Transform (Reliable)&quot;</span>)]</div>
<div class="foldopen" id="foldopen00009" data-start="{" data-end="};">
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html">    9</a></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code hl_class" href="class_mirror_1_1_network_transform_reliable.html">NetworkTransformReliable</a> : <a class="code hl_class" href="class_mirror_1_1_network_transform_base.html">NetworkTransformBase</a></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>    {</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> sendIntervalCounter = 0;</div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>        <span class="keywordtype">double</span> lastSendIntervalTime = <span class="keywordtype">double</span>.MinValue;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Tooltip</a>(<span class="stringliteral">&quot;If we only sync on change, then we need to correct old snapshots if more time than sendInterval * multiplier has elapsed.\n\nOtherwise the first move will always start interpolating from the last move sequence&#39;s time, which will make it stutter when starting every time.&quot;</span>)]</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#ac27c545389a6998ded75708e00e69089">   15</a></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ac27c545389a6998ded75708e00e69089">onlySyncOnChangeCorrectionMultiplier</a> = 2;</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>        [Header(<span class="stringliteral">&quot;Rotation&quot;</span>)]</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Tooltip</a>(<span class="stringliteral">&quot;Sensitivity of changes needed before an updated state is sent over the network&quot;</span>)]</div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a1aea8124a3b21bed7e6ec8dd90ec8d11">   19</a></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a1aea8124a3b21bed7e6ec8dd90ec8d11">rotationSensitivity</a> = 0.01f;</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>        <span class="comment">// delta compression is capable of detecting byte-level changes.</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>        <span class="comment">// if we scale float position to bytes,</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>        <span class="comment">// then small movements will only change one byte.</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>        <span class="comment">// this gives optimal bandwidth.</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>        <span class="comment">//   benchmark with 0.01 precision: 130 KB/s =&gt; 60 KB/s</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>        <span class="comment">//   benchmark with 0.1  precision: 130 KB/s =&gt; 30 KB/s</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>        [Header(<span class="stringliteral">&quot;Precision&quot;</span>)]</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Tooltip</a>(<span class="stringliteral">&quot;Position is rounded in order to drastically minimize bandwidth.\n\nFor example, a precision of 0.01 rounds to a centimeter. In other words, sub-centimeter movements aren&#39;t synced until they eventually exceeded an actual centimeter.\n\nDepending on how important the object is, a precision of 0.01-0.10 (1-10 cm) is recommended.\n\nFor example, even a 1cm precision combined with delta compression cuts the Benchmark demo&#39;s bandwidth in half, compared to sending every tiny change.&quot;</span>)]</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Range</a>(0.00<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">_01f</a>, 1f)]                   <span class="comment">// disallow 0 division. 1mm to 1m precision is enough range.</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#afdcbc6564979e813341d4426c23a7bf6">   30</a></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afdcbc6564979e813341d4426c23a7bf6">positionPrecision</a> = 0.01f; <span class="comment">// 1 cm</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Range</a>(0.00<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">_01f</a>, 1f)]                   <span class="comment">// disallow 0 division. 1mm to 1m precision is enough range.</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a878c5147b0b81f564e2d2b776c25745c">   32</a></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a878c5147b0b81f564e2d2b776c25745c">scalePrecision</a> = 0.01f; <span class="comment">// 1 cm</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>        <span class="comment">// delta compression needs to remember &#39;last&#39; to compress against</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#afd5d1fb3a64302608ecfdb0850103d03">   35</a></span>        <span class="keyword">protected</span> <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afd5d1fb3a64302608ecfdb0850103d03">lastSerializedPosition</a> = <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a>.<a class="code hl_variable" href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">zero</a>;</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a74ee1ce3dc7409d5b781485db9b23b6e">   36</a></span>        <span class="keyword">protected</span> <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a74ee1ce3dc7409d5b781485db9b23b6e">lastDeserializedPosition</a> = <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a>.<a class="code hl_variable" href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">zero</a>;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a0ad06a313f02e169e36f100912810313">   38</a></span>        <span class="keyword">protected</span> <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a0ad06a313f02e169e36f100912810313">lastSerializedScale</a> = <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a>.<a class="code hl_variable" href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">zero</a>;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#addcde9d14bc5cd73a54dfc6fb76385a6">   39</a></span>        <span class="keyword">protected</span> <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#addcde9d14bc5cd73a54dfc6fb76385a6">lastDeserializedScale</a> = <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a>.<a class="code hl_variable" href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">zero</a>;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>        <span class="comment">// Used to store last sent snapshots</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">   42</a></span>        <span class="keyword">protected</span> <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">last</a>;</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a113c21f24f6482d413a4840f8d89ea9d">   44</a></span>        <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a113c21f24f6482d413a4840f8d89ea9d">lastClientCount</a> = 1;</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        <span class="comment">// update //////////////////////////////////////////////////////////////</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>        <span class="keywordtype">void</span> Update()</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        {</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>            <span class="comment">// if server then always sync to others.</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#a6a65dec5ade34544074c2f997932e17a">isServer</a>) <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#ab9ea63d5c19fc75c87ef01c3c639cfb8">UpdateServer</a>();</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>            <span class="comment">// &#39;else if&#39; because host mode shouldn&#39;t send anything to server.</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>            <span class="comment">// it is the server. don&#39;t overwrite anything there.</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#ab30e4e9deea5ea728bbf8910ba4aa0fc">isClient</a>) <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#a70a3f649e0dbbd2f8042171ac5d75c09">UpdateClient</a>();</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>        }</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span> </div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>        <span class="keywordtype">void</span> LateUpdate()</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        {</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>            <span class="comment">// set dirty to trigger OnSerialize. either always, or only if changed.</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>            <span class="comment">// It has to be checked in LateUpdate() for onlySyncOnChange to avoid</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>            <span class="comment">// the possibility of Update() running first before the object&#39;s movement</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>            <span class="comment">// script&#39;s Update(), which then causes NT to send every alternate frame</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>            <span class="comment">// instead.</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#a6a65dec5ade34544074c2f997932e17a">isServer</a> || (<a class="code hl_property" href="class_mirror_1_1_network_transform_base.html#ae025bfcb11990f490476aa343f5eda04">IsClientWithAuthority</a> &amp;&amp; NetworkClient.ready))</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            {</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>                <span class="keywordflow">if</span> (sendIntervalCounter == <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a3aeee8a10549d1702425e40cad14a5ff">sendIntervalMultiplier</a> &amp;&amp; (!<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a81910dd9c1d873404027f5dc57e3afe3">onlySyncOnChange</a> || <a class="code hl_enumeration" href="namespace_mirror.html#ae89dcc4d1b24e073ba6ee149d1c08f42">Changed</a>(<a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#af752efb0bc69a9d09219a293ea680f0d">Construct</a>())))</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>                    <a class="code hl_function" href="class_mirror_1_1_network_behaviour.html#aa54c7efe36af763380824091dd7e6159">SetDirty</a>();</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>                <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#a1afcd3d27f5a07ce174d5d73a8055be0">CheckLastSendTime</a>();</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>            }</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        }</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="foldopen" id="foldopen00072" data-start="{" data-end="}">
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#ab9ea63d5c19fc75c87ef01c3c639cfb8">   72</a></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#ab9ea63d5c19fc75c87ef01c3c639cfb8">UpdateServer</a>()</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        {</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>            <span class="comment">// apply buffered snapshots IF client authority</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>            <span class="comment">// -&gt; in server authority, server moves the object</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>            <span class="comment">//    so no need to apply any snapshots there.</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>            <span class="comment">// -&gt; don&#39;t apply for host mode player objects either, even if in</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            <span class="comment">//    client authority mode. if it doesn&#39;t go over the network,</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>            <span class="comment">//    then we don&#39;t need to do anything.</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <span class="comment">// -&gt; connectionToClient is briefly null after scene changes:</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>            <span class="comment">//    https://github.com/MirrorNetworking/Mirror/issues/3329</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_behaviour.html#a3e6dfe7de8eac46346abcc3153c6a0c8">syncDirection</a> == <a class="code hl_enumeration" href="namespace_mirror.html#a3a4f3784dd23e16377d46532b14bae88">SyncDirection</a>.ClientToServer &amp;&amp;</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>                <a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#abb008e87f9af42274a51453cb2717bec">connectionToClient</a> != <span class="keyword">null</span> &amp;&amp;</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>                !<a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#ae188c39e2bc2ec519d25f285444bc5fc">isOwned</a>)</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            {</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab0869dec560d1ebc82080f9767cd96b1">serverSnapshots</a>.Count &gt; 0)</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>                {</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>                    <span class="comment">// step the transform interpolation without touching time.</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>                    <span class="comment">// NetworkClient is responsible for time globally.</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>                    SnapshotInterpolation.StepInterpolation(</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                        <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab0869dec560d1ebc82080f9767cd96b1">serverSnapshots</a>,</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                        <a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#abb008e87f9af42274a51453cb2717bec">connectionToClient</a>.<a class="code hl_variable" href="class_mirror_1_1_network_connection_to_client.html#a622b62325e2a932390d1c446b0239792">remoteTimeline</a>,</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">from</a>,</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">to</a>,</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <span class="keywordtype">double</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">t</a>);</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                    <span class="comment">// interpolate &amp; apply</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>                    <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">computed</a> = <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a>.<a class="code hl_function" href="struct_mirror_1_1_transform_snapshot.html#a6532d3f99fa1174b67e46993d9b731e3">Interpolate</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">from</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">to</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">t</a>);</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>                    <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#a18d3d7135d04c17520a5d35c50b976ef">Apply</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">computed</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">to</a>);</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>                }</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>            }</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>        }</div>
</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="foldopen" id="foldopen00104" data-start="{" data-end="}">
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a70a3f649e0dbbd2f8042171ac5d75c09">  104</a></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#a70a3f649e0dbbd2f8042171ac5d75c09">UpdateClient</a>()</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        {</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            <span class="comment">// client authority, and local player (= allowed to move myself)?</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>            <span class="keywordflow">if</span> (!<a class="code hl_property" href="class_mirror_1_1_network_transform_base.html#ae025bfcb11990f490476aa343f5eda04">IsClientWithAuthority</a>)</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>            {</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>                <span class="comment">// only while we have snapshots</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab273ae81f6a8332c6a4ac08dbf18822b">clientSnapshots</a>.Count &gt; 0)</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>                {</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                    <span class="comment">// step the interpolation without touching time.</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                    <span class="comment">// NetworkClient is responsible for time globally.</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                    SnapshotInterpolation.StepInterpolation(</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>                        <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab273ae81f6a8332c6a4ac08dbf18822b">clientSnapshots</a>,</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>                        NetworkTime.time, <span class="comment">// == NetworkClient.localTimeline from snapshot interpolation</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">from</a>,</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">to</a>,</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <span class="keywordtype">double</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">t</a>);</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>                    <span class="comment">// interpolate &amp; apply</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>                    <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">computed</a> = <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a>.<a class="code hl_function" href="struct_mirror_1_1_transform_snapshot.html#a6532d3f99fa1174b67e46993d9b731e3">Interpolate</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">from</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">to</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">t</a>);</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>                    <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#a18d3d7135d04c17520a5d35c50b976ef">Apply</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">computed</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">to</a>);</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>                }</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>                <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a113c21f24f6482d413a4840f8d89ea9d">lastClientCount</a> = <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab273ae81f6a8332c6a4ac08dbf18822b">clientSnapshots</a>.Count;</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>            }</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>        }</div>
</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="foldopen" id="foldopen00130" data-start="{" data-end="}">
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a1afcd3d27f5a07ce174d5d73a8055be0">  130</a></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#a1afcd3d27f5a07ce174d5d73a8055be0">CheckLastSendTime</a>()</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        {</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>            <span class="comment">// timeAsDouble not available in older Unity versions.</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>            <span class="keywordflow">if</span> (AccurateInterval.Elapsed(NetworkTime.localTime, NetworkServer.sendInterval, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ref</a> lastSendIntervalTime))</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>            {</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>                <span class="keywordflow">if</span> (sendIntervalCounter == <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a3aeee8a10549d1702425e40cad14a5ff">sendIntervalMultiplier</a>)</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>                    sendIntervalCounter = 0;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>                sendIntervalCounter++;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>            }</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>        }</div>
</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        <span class="comment">// check if position / rotation / scale changed since last sync</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a1d11d92f0f3e1990ae06b6216ada6665">  142</a></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#a1d11d92f0f3e1990ae06b6216ada6665">Changed</a>(<a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> current) =&gt;</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>            <span class="comment">// position is quantized and delta compressed.</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>            <span class="comment">// only consider it changed if the quantized representation is changed.</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>            <span class="comment">// careful: don&#39;t use &#39;serialized / deserialized last&#39;. as it depends on sync mode etc.</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>            <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#aa584b9de7520d4e8482307438552eb4e">QuantizedChanged</a>(<a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">last</a>.<a class="code hl_variable" href="struct_mirror_1_1_transform_snapshot.html#a1ee6d6dbe34e79d5dc31cc483eaf69d9">position</a>, current.position, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afdcbc6564979e813341d4426c23a7bf6">positionPrecision</a>) ||</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>            <span class="comment">// rotation isn&#39;t quantized / delta compressed.</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>            <span class="comment">// check with sensitivity.</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Quaternion</a>.Angle(<a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">last</a>.<a class="code hl_variable" href="struct_mirror_1_1_transform_snapshot.html#ad584289d664a198557a7008a7fde11fe">rotation</a>, current.rotation) &gt; <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a1aea8124a3b21bed7e6ec8dd90ec8d11">rotationSensitivity</a> ||</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>            <span class="comment">// scale is quantized and delta compressed.</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>            <span class="comment">// only consider it changed if the quantized representation is changed.</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>            <span class="comment">// careful: don&#39;t use &#39;serialized / deserialized last&#39;. as it depends on sync mode etc.</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>            <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#aa584b9de7520d4e8482307438552eb4e">QuantizedChanged</a>(<a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">last</a>.<a class="code hl_variable" href="struct_mirror_1_1_transform_snapshot.html#aa80a6912f2cfcaf5ea643899b431a8b2">scale</a>, current.scale, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a878c5147b0b81f564e2d2b776c25745c">scalePrecision</a>);</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        <span class="comment">// helper function to compare quantized representations of a Vector3</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">MethodImpl</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">MethodImplOptions</a>.AggressiveInlining)]</div>
<div class="foldopen" id="foldopen00157" data-start="{" data-end="}">
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#aa584b9de7520d4e8482307438552eb4e">  157</a></span>        <span class="keyword">protected</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#aa584b9de7520d4e8482307438552eb4e">QuantizedChanged</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">u</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">v</a>, <span class="keywordtype">float</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">precision</a>)</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>        {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>            Compression.ScaleToLong(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">u</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">precision</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uQuantized</a>);</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>            Compression.ScaleToLong(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">v</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">precision</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">vQuantized</a>);</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            <span class="keywordflow">return</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uQuantized</a> != <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">vQuantized</a>;</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        }</div>
</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="comment">// NT may be used on client/server/host to Owner/Observers with</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <span class="comment">// ServerToClient or ClientToServer.</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <span class="comment">// however, OnSerialize should always delta against last.</span></div>
<div class="foldopen" id="foldopen00167" data-start="{" data-end="}">
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#ad6b0e608dc0689a392c93a74a7871c72">  167</a></span>        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#ad6b0e608dc0689a392c93a74a7871c72">OnSerialize</a>(<a class="code hl_class" href="class_mirror_1_1_network_writer.html">NetworkWriter</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>, <span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>)</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        {</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>            <span class="comment">// get current snapshot for broadcasting.</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>            <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a> = <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#af752efb0bc69a9d09219a293ea680f0d">Construct</a>();</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>            <span class="comment">// ClientToServer optimization:</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>            <span class="comment">// for interpolated client owned identities,</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>            <span class="comment">// always broadcast the latest known snapshot so other clients can</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            <span class="comment">// interpolate immediately instead of catching up too</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>            <span class="comment">// TODO dirty mask? [compression is very good w/o it already]</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>            <span class="comment">// each vector&#39;s component is delta compressed.</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>            <span class="comment">// an unchanged component would still require 1 byte.</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>            <span class="comment">// let&#39;s use a dirty bit mask to filter those out as well.</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>            <span class="comment">// initial</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>)</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>            {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>                <span class="comment">// If there is a last serialized snapshot, we use it.</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>                <span class="comment">// This prevents the new client getting a snapshot that is different</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>                <span class="comment">// from what the older clients last got. If this happens, and on the next</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                <span class="comment">// regular serialisation the delta compression will get wrong values.</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                <span class="comment">// Notes:</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                <span class="comment">// 1. Interestingly only the older clients have it wrong, because at the end</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                <span class="comment">//    of this function, last = snapshot which is the initial state&#39;s snapshot</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                <span class="comment">// 2. Regular NTR gets by this bug because it sends every frame anyway so initialstate</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>                <span class="comment">//    snapshot constructed would have been the same as the last anyway.</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">last</a>.<a class="code hl_property" href="struct_mirror_1_1_transform_snapshot.html#ad863b1495c27b43d1c94598ac255653a">remoteTime</a> &gt; 0) <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a> = <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">last</a>;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a6d136497581ed553c7c426dfe6997a95">syncPosition</a>) <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>.WriteVector3(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.position);</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#acc612b7a23024468e277827908a66567">syncRotation</a>)</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>                {</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>                    <span class="comment">// (optional) smallest three compression for now. no delta.</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab7e0831638765f17e9800e1b0dc7091a">compressRotation</a>)</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>.WriteUInt(Compression.CompressQuaternion(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.rotation));</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>                    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>.WriteQuaternion(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.rotation);</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>                }</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#aa7551af797a7a8259d6a0c4c955d68a2">syncScale</a>) <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>.WriteVector3(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.scale);</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>            }</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            <span class="comment">// delta</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>            {</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>                <span class="comment">// int before = writer.Position;</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a6d136497581ed553c7c426dfe6997a95">syncPosition</a>)</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>                {</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>                    <span class="comment">// quantize -&gt; delta -&gt; varint</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>                    Compression.ScaleToLong(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.position, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afdcbc6564979e813341d4426c23a7bf6">positionPrecision</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">quantized</a>);</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>                    DeltaCompression.Compress(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afd5d1fb3a64302608ecfdb0850103d03">lastSerializedPosition</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">quantized</a>);</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>                }</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#acc612b7a23024468e277827908a66567">syncRotation</a>)</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>                {</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>                    <span class="comment">// (optional) smallest three compression for now. no delta.</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab7e0831638765f17e9800e1b0dc7091a">compressRotation</a>)</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>.WriteUInt(Compression.CompressQuaternion(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.rotation));</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>                    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>.WriteQuaternion(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.rotation);</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>                }</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#aa7551af797a7a8259d6a0c4c955d68a2">syncScale</a>)</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>                {</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>                    <span class="comment">// quantize -&gt; delta -&gt; varint</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>                    Compression.ScaleToLong(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.scale, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a878c5147b0b81f564e2d2b776c25745c">scalePrecision</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">quantized</a>);</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>                    DeltaCompression.Compress(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a0ad06a313f02e169e36f100912810313">lastSerializedScale</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">quantized</a>);</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>                }</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>            }</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            <span class="comment">// save serialized as &#39;last&#39; for next delta compression</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a6d136497581ed553c7c426dfe6997a95">syncPosition</a>) Compression.ScaleToLong(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.position, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afdcbc6564979e813341d4426c23a7bf6">positionPrecision</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afd5d1fb3a64302608ecfdb0850103d03">lastSerializedPosition</a>);</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#aa7551af797a7a8259d6a0c4c955d68a2">syncScale</a>) Compression.ScaleToLong(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>.scale, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a878c5147b0b81f564e2d2b776c25745c">scalePrecision</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a0ad06a313f02e169e36f100912810313">lastSerializedScale</a>);</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span> </div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>            <span class="comment">// set &#39;last&#39;</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>            <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">last</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">snapshot</a>;</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>        }</div>
</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="foldopen" id="foldopen00241" data-start="{" data-end="}">
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#aa9ebe89953d5b8f6c4fcfd1101a0d16c">  241</a></span>        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#aa9ebe89953d5b8f6c4fcfd1101a0d16c">OnDeserialize</a>(<a class="code hl_class" href="class_mirror_1_1_network_reader.html">NetworkReader</a> reader, <span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>)</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        {</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a>? position = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Quaternion</a>? rotation = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a>? scale = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>            <span class="comment">// initial</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>)</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            {</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a6d136497581ed553c7c426dfe6997a95">syncPosition</a>) position = reader.ReadVector3();</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#acc612b7a23024468e277827908a66567">syncRotation</a>)</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>                {</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>                    <span class="comment">// (optional) smallest three compression for now. no delta.</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab7e0831638765f17e9800e1b0dc7091a">compressRotation</a>)</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>                        rotation = Compression.DecompressQuaternion(reader.ReadUInt());</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>                    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>                        rotation = reader.ReadQuaternion();</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>                }</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#aa7551af797a7a8259d6a0c4c955d68a2">syncScale</a>) scale = reader.ReadVector3();</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            }</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            <span class="comment">// delta</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>            {</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>                <span class="comment">// varint -&gt; delta -&gt; quantize</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a6d136497581ed553c7c426dfe6997a95">syncPosition</a>)</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                {</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>                    <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">quantized</a> = DeltaCompression.Decompress(reader, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a74ee1ce3dc7409d5b781485db9b23b6e">lastDeserializedPosition</a>);</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                    position = Compression.ScaleToFloat(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">quantized</a>, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afdcbc6564979e813341d4426c23a7bf6">positionPrecision</a>);</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                }</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#acc612b7a23024468e277827908a66567">syncRotation</a>)</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>                {</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                    <span class="comment">// (optional) smallest three compression for now. no delta.</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab7e0831638765f17e9800e1b0dc7091a">compressRotation</a>)</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>                        rotation = Compression.DecompressQuaternion(reader.ReadUInt());</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>                    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>                        rotation = reader.ReadQuaternion();</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>                }</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#aa7551af797a7a8259d6a0c4c955d68a2">syncScale</a>)</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>                {</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>                    <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">quantized</a> = DeltaCompression.Decompress(reader, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#addcde9d14bc5cd73a54dfc6fb76385a6">lastDeserializedScale</a>);</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>                    scale = Compression.ScaleToFloat(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">quantized</a>, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a878c5147b0b81f564e2d2b776c25745c">scalePrecision</a>);</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>                }</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>            }</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>            <span class="comment">// handle depending on server / client / host.</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>            <span class="comment">// server has priority for host mode.</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#a6a65dec5ade34544074c2f997932e17a">isServer</a>) <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#aa7e13687c2c3322fa8d0de7a648f5927">OnClientToServerSync</a>(position, rotation, scale);</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#ab30e4e9deea5ea728bbf8910ba4aa0fc">isClient</a>) <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#ad223d83a739cf988e89fec613e7f14cd">OnServerToClientSync</a>(position, rotation, scale);</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            <span class="comment">// save deserialized as &#39;last&#39; for next delta compression</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a6d136497581ed553c7c426dfe6997a95">syncPosition</a>) Compression.ScaleToLong(position.Value, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afdcbc6564979e813341d4426c23a7bf6">positionPrecision</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a74ee1ce3dc7409d5b781485db9b23b6e">lastDeserializedPosition</a>);</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#aa7551af797a7a8259d6a0c4c955d68a2">syncScale</a>) Compression.ScaleToLong(scale.Value, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a878c5147b0b81f564e2d2b776c25745c">scalePrecision</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#addcde9d14bc5cd73a54dfc6fb76385a6">lastDeserializedScale</a>);</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        }</div>
</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span> </div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>        <span class="comment">// sync ////////////////////////////////////////////////////////////////</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        <span class="comment">// local authority client sends sync message to server for broadcasting</span></div>
<div class="foldopen" id="foldopen00298" data-start="{" data-end="}">
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#aa7e13687c2c3322fa8d0de7a648f5927">  298</a></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#aa7e13687c2c3322fa8d0de7a648f5927">OnClientToServerSync</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a>? position, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Quaternion</a>? rotation, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a>? scale)</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>        {</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>            <span class="comment">// only apply if in client authority mode</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_behaviour.html#a3e6dfe7de8eac46346abcc3153c6a0c8">syncDirection</a> != <a class="code hl_enumeration" href="namespace_mirror.html#a3a4f3784dd23e16377d46532b14bae88">SyncDirection</a>.ClientToServer) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            <span class="comment">// protect against ever growing buffer size attacks</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab0869dec560d1ebc82080f9767cd96b1">serverSnapshots</a>.Count &gt;= <a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#abb008e87f9af42274a51453cb2717bec">connectionToClient</a>.<a class="code hl_variable" href="class_mirror_1_1_network_connection_to_client.html#ae230aea7cd1fedcfd4ff2532b64a01e4">snapshotBufferSizeLimit</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>            <span class="comment">// &#39;only sync on change&#39; needs a correction on every new move sequence.</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a81910dd9c1d873404027f5dc57e3afe3">onlySyncOnChange</a> &amp;&amp;</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                NeedsCorrection(<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab0869dec560d1ebc82080f9767cd96b1">serverSnapshots</a>, <a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#abb008e87f9af42274a51453cb2717bec">connectionToClient</a>.<a class="code hl_property" href="class_mirror_1_1_network_connection.html#a281001e7a591512c30531540281ec3b1">remoteTimeStamp</a>, NetworkServer.sendInterval * <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a3aeee8a10549d1702425e40cad14a5ff">sendIntervalMultiplier</a>, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ac27c545389a6998ded75708e00e69089">onlySyncOnChangeCorrectionMultiplier</a>))</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>            {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>                RewriteHistory(</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>                    <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab0869dec560d1ebc82080f9767cd96b1">serverSnapshots</a>,</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>                    <a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#abb008e87f9af42274a51453cb2717bec">connectionToClient</a>.<a class="code hl_property" href="class_mirror_1_1_network_connection.html#a281001e7a591512c30531540281ec3b1">remoteTimeStamp</a>,</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                    NetworkTime.localTime,                                  <span class="comment">// arrival remote timestamp. NOT remote timeline.</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                    NetworkServer.sendInterval * <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a3aeee8a10549d1702425e40cad14a5ff">sendIntervalMultiplier</a>,    <span class="comment">// Unity 2019 doesn&#39;t have timeAsDouble yet</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                    <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#a190c78bc04048a620c7f6d1c60b6b260">GetPosition</a>(),</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>                    <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#a78d6a03bf153a3fb4af360b7cfc502d5">GetRotation</a>(),</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>                    <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#a94fc8ba8f1df542c4a88a77a7889308a">GetScale</a>());</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>            }</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span> </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>            <span class="comment">// add a small timeline offset to account for decoupled arrival of</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>            <span class="comment">// NetworkTime and NetworkTransform snapshots.</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            <span class="comment">// needs to be sendInterval. half sendInterval doesn&#39;t solve it.</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>            <span class="comment">// https://github.com/MirrorNetworking/Mirror/issues/3427</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>            <span class="comment">// remove this after LocalWorldState.</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>            <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#aa1fc84eef8318eb43ea7bf08c0fcf321">AddSnapshot</a>(<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab0869dec560d1ebc82080f9767cd96b1">serverSnapshots</a>, <a class="code hl_property" href="class_mirror_1_1_network_behaviour.html#abb008e87f9af42274a51453cb2717bec">connectionToClient</a>.<a class="code hl_property" href="class_mirror_1_1_network_connection.html#a281001e7a591512c30531540281ec3b1">remoteTimeStamp</a> + <a class="code hl_property" href="class_mirror_1_1_network_transform_base.html#a4b8d4a60bd67f5d09d94c3e6af9a7d8d">timeStampAdjustment</a> + <a class="code hl_property" href="class_mirror_1_1_network_transform_base.html#af478591af670f347ce0b760de2163c48">offset</a>, position, rotation, scale);</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        }</div>
</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>        <span class="comment">// server broadcasts sync message to all clients</span></div>
<div class="foldopen" id="foldopen00329" data-start="{" data-end="}">
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#ad223d83a739cf988e89fec613e7f14cd">  329</a></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#ad223d83a739cf988e89fec613e7f14cd">OnServerToClientSync</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a>? position, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Quaternion</a>? rotation, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a>? scale)</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        {</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>            <span class="comment">// don&#39;t apply for local player with authority</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_transform_base.html#ae025bfcb11990f490476aa343f5eda04">IsClientWithAuthority</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>            <span class="comment">// &#39;only sync on change&#39; needs a correction on every new move sequence.</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a81910dd9c1d873404027f5dc57e3afe3">onlySyncOnChange</a> &amp;&amp;</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                NeedsCorrection(<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab273ae81f6a8332c6a4ac08dbf18822b">clientSnapshots</a>, NetworkClient.connection.remoteTimeStamp, NetworkClient.sendInterval * <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a3aeee8a10549d1702425e40cad14a5ff">sendIntervalMultiplier</a>, <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ac27c545389a6998ded75708e00e69089">onlySyncOnChangeCorrectionMultiplier</a>))</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>            {</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                RewriteHistory(</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>                    <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab273ae81f6a8332c6a4ac08dbf18822b">clientSnapshots</a>,</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>                    NetworkClient.connection.remoteTimeStamp,               <span class="comment">// arrival remote timestamp. NOT remote timeline.</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>                    NetworkTime.localTime,                                  <span class="comment">// Unity 2019 doesn&#39;t have timeAsDouble yet</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>                    NetworkClient.sendInterval * <a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#a3aeee8a10549d1702425e40cad14a5ff">sendIntervalMultiplier</a>,</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>                    <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#a190c78bc04048a620c7f6d1c60b6b260">GetPosition</a>(),</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>                    <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#a78d6a03bf153a3fb4af360b7cfc502d5">GetRotation</a>(),</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>                    <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#a94fc8ba8f1df542c4a88a77a7889308a">GetScale</a>());</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>            }</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>            <span class="comment">// add a small timeline offset to account for decoupled arrival of</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            <span class="comment">// NetworkTime and NetworkTransform snapshots.</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            <span class="comment">// needs to be sendInterval. half sendInterval doesn&#39;t solve it.</span></div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>            <span class="comment">// https://github.com/MirrorNetworking/Mirror/issues/3427</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>            <span class="comment">// remove this after LocalWorldState.</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>            <a class="code hl_function" href="class_mirror_1_1_network_transform_base.html#aa1fc84eef8318eb43ea7bf08c0fcf321">AddSnapshot</a>(<a class="code hl_variable" href="class_mirror_1_1_network_transform_base.html#ab273ae81f6a8332c6a4ac08dbf18822b">clientSnapshots</a>, NetworkClient.connection.remoteTimeStamp + <a class="code hl_property" href="class_mirror_1_1_network_transform_base.html#a4b8d4a60bd67f5d09d94c3e6af9a7d8d">timeStampAdjustment</a> + <a class="code hl_property" href="class_mirror_1_1_network_transform_base.html#af478591af670f347ce0b760de2163c48">offset</a>, position, rotation, scale);</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        }</div>
</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        <span class="comment">// only sync on change /////////////////////////////////////////////////</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>        <span class="comment">// snap interp. needs a continous flow of packets.</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        <span class="comment">// &#39;only sync on change&#39; interrupts it while not changed.</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        <span class="comment">// once it restarts, snap interp. will interp from the last old position.</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        <span class="comment">// this will cause very noticeable stutter for the first move each time.</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        <span class="comment">// the fix is quite simple.</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        <span class="comment">// 1. detect if the remaining snapshot is too old from a past move.</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>        <span class="keyword">static</span> <span class="keywordtype">bool</span> NeedsCorrection(</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">SortedList&lt;double, TransformSnapshot&gt;</a> snapshots,</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>            <span class="keywordtype">double</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">remoteTimestamp</a>,</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>            <span class="keywordtype">double</span> bufferTime,</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>            <span class="keywordtype">double</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">toleranceMultiplier</a>) =&gt;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>                snapshots.Count == 1 &amp;&amp;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">remoteTimestamp</a> - snapshots.Keys[0] &gt;= bufferTime * <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">toleranceMultiplier</a>;</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        <span class="comment">// 2. insert a fake snapshot at current position,</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        <span class="comment">//    exactly one &#39;sendInterval&#39; behind the newly received one.</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        <span class="keyword">static</span> <span class="keywordtype">void</span> RewriteHistory(</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">SortedList&lt;double, TransformSnapshot&gt;</a> snapshots,</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>            <span class="comment">// timestamp of packet arrival, not interpolated remote time!</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>            <span class="keywordtype">double</span> remoteTimeStamp,</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>            <span class="keywordtype">double</span> localTime,</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>            <span class="keywordtype">double</span> sendInterval,</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a> position,</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Quaternion</a> rotation,</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a> scale)</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        {</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>            <span class="comment">// clear the previous snapshot</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>            snapshots.Clear();</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>            <span class="comment">// insert a fake one at where we used to be,</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>            <span class="comment">// &#39;sendInterval&#39; behind the new one.</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>            SnapshotInterpolation.InsertIfNotExists(</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>                snapshots,</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                NetworkClient.snapshotSettings.bufferLimit,</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>                <span class="keyword">new</span> <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a>(</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>                    remoteTimeStamp - sendInterval, <span class="comment">// arrival remote timestamp. NOT remote time.</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                    localTime - sendInterval,       <span class="comment">// Unity 2019 doesn&#39;t have timeAsDouble yet</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>                    position,</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                    rotation,</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                    scale</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                )</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            );</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        }</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span> </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>        <span class="comment">// reset state for next session.</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        <span class="comment">// do not ever call this during a session (i.e. after teleport).</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        <span class="comment">// calling this will break delta compression.</span></div>
<div class="foldopen" id="foldopen00405" data-start="{" data-end="}">
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_transform_reliable.html#a5bf81733af39600f7e15a29d0554d54b">  405</a></span>        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_transform_reliable.html#a5bf81733af39600f7e15a29d0554d54b">ResetState</a>()</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>        {</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">base</a>.ResetState();</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span> </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>            <span class="comment">// reset delta</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>            <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#afd5d1fb3a64302608ecfdb0850103d03">lastSerializedPosition</a> = <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a>.<a class="code hl_variable" href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">zero</a>;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>            <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a74ee1ce3dc7409d5b781485db9b23b6e">lastDeserializedPosition</a> = <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a>.<a class="code hl_variable" href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">zero</a>;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>            <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#a0ad06a313f02e169e36f100912810313">lastSerializedScale</a> = <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a>.<a class="code hl_variable" href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">zero</a>;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>            <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#addcde9d14bc5cd73a54dfc6fb76385a6">lastDeserializedScale</a> = <a class="code hl_struct" href="struct_mirror_1_1_vector3_long.html">Vector3Long</a>.<a class="code hl_variable" href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">zero</a>;</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span> </div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>            <span class="comment">// reset &#39;last&#39; for delta too</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>            <a class="code hl_variable" href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">last</a> = <span class="keyword">new</span> <a class="code hl_struct" href="struct_mirror_1_1_transform_snapshot.html">TransformSnapshot</a>(0, 0, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a>.zero, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Quaternion</a>.identity, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Vector3</a>.zero);</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        }</div>
</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    }</div>
</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>}</div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_a3e6dfe7de8eac46346abcc3153c6a0c8"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#a3e6dfe7de8eac46346abcc3153c6a0c8">Mirror.NetworkBehaviour.syncDirection</a></div><div class="ttdeci">SyncDirection syncDirection</div><div class="ttdoc">Sync direction for OnSerialize. ServerToClient by default. ClientToServer for client authority.</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00029">NetworkBehaviour.cs:29</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_a6a65dec5ade34544074c2f997932e17a"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#a6a65dec5ade34544074c2f997932e17a">Mirror.NetworkBehaviour.isServer</a></div><div class="ttdeci">bool isServer</div><div class="ttdoc">True if this object is on the server and has been spawned.</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00052">NetworkBehaviour.cs:52</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_aa54c7efe36af763380824091dd7e6159"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#aa54c7efe36af763380824091dd7e6159">Mirror.NetworkBehaviour.SetDirty</a></div><div class="ttdeci">void SetDirty()</div><div class="ttdoc">Set as dirty to trigger OnSerialize &amp; send. Dirty bits are cleared after the send.</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_ab30e4e9deea5ea728bbf8910ba4aa0fc"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#ab30e4e9deea5ea728bbf8910ba4aa0fc">Mirror.NetworkBehaviour.isClient</a></div><div class="ttdeci">bool isClient</div><div class="ttdoc">True if this object is on the client and has been spawned by the server.</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00055">NetworkBehaviour.cs:55</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_abb008e87f9af42274a51453cb2717bec"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#abb008e87f9af42274a51453cb2717bec">Mirror.NetworkBehaviour.connectionToClient</a></div><div class="ttdeci">NetworkConnectionToClient connectionToClient</div><div class="ttdoc">Server's network connection to the client. This is only valid for player objects on the server.</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00108">NetworkBehaviour.cs:108</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_ae188c39e2bc2ec519d25f285444bc5fc"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#ae188c39e2bc2ec519d25f285444bc5fc">Mirror.NetworkBehaviour.isOwned</a></div><div class="ttdeci">bool isOwned</div><div class="ttdoc">isOwned is true on the client if this NetworkIdentity is one of the .owned entities of our connection...</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00068">NetworkBehaviour.cs:68</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_connection_html_a281001e7a591512c30531540281ec3b1"><div class="ttname"><a href="class_mirror_1_1_network_connection.html#a281001e7a591512c30531540281ec3b1">Mirror.NetworkConnection.remoteTimeStamp</a></div><div class="ttdeci">double remoteTimeStamp</div><div class="ttdoc">last batch's remote timestamp. not interpolated. useful for NetworkTransform etc.</div><div class="ttdef"><b>Definition</b> <a href="_mirror_2_core_2_network_connection_8cs_source.html#l00062">NetworkConnection.cs:62</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_connection_to_client_html_a622b62325e2a932390d1c446b0239792"><div class="ttname"><a href="class_mirror_1_1_network_connection_to_client.html#a622b62325e2a932390d1c446b0239792">Mirror.NetworkConnectionToClient.remoteTimeline</a></div><div class="ttdeci">double remoteTimeline</div><div class="ttdef"><b>Definition</b> <a href="_network_connection_to_client_8cs_source.html#l00034">NetworkConnectionToClient.cs:34</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_connection_to_client_html_ae230aea7cd1fedcfd4ff2532b64a01e4"><div class="ttname"><a href="class_mirror_1_1_network_connection_to_client.html#ae230aea7cd1fedcfd4ff2532b64a01e4">Mirror.NetworkConnectionToClient.snapshotBufferSizeLimit</a></div><div class="ttdeci">int snapshotBufferSizeLimit</div><div class="ttdef"><b>Definition</b> <a href="_network_connection_to_client_8cs_source.html#l00043">NetworkConnectionToClient.cs:43</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_reader_html"><div class="ttname"><a href="class_mirror_1_1_network_reader.html">Mirror.NetworkReader</a></div><div class="ttdoc">Network Reader for most simple types like floats, ints, buffers, structs, etc. Use NetworkReaderPool....</div><div class="ttdef"><b>Definition</b> <a href="_network_reader_8cs_source.html#l00018">NetworkReader.cs:19</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html">Mirror.NetworkTransformBase</a></div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00027">NetworkTransformBase.cs:28</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_a18d3d7135d04c17520a5d35c50b976ef"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#a18d3d7135d04c17520a5d35c50b976ef">Mirror.NetworkTransformBase.Apply</a></div><div class="ttdeci">virtual void Apply(TransformSnapshot interpolated, TransformSnapshot endGoal)</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00221">NetworkTransformBase.cs:221</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_a190c78bc04048a620c7f6d1c60b6b260"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#a190c78bc04048a620c7f6d1c60b6b260">Mirror.NetworkTransformBase.GetPosition</a></div><div class="ttdeci">virtual Vector3 GetPosition()</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_a3aeee8a10549d1702425e40cad14a5ff"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#a3aeee8a10549d1702425e40cad14a5ff">Mirror.NetworkTransformBase.sendIntervalMultiplier</a></div><div class="ttdeci">uint sendIntervalMultiplier</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00073">NetworkTransformBase.cs:73</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_a4b8d4a60bd67f5d09d94c3e6af9a7d8d"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#a4b8d4a60bd67f5d09d94c3e6af9a7d8d">Mirror.NetworkTransformBase.timeStampAdjustment</a></div><div class="ttdeci">double timeStampAdjustment</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00092">NetworkTransformBase.cs:92</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_a6d136497581ed553c7c426dfe6997a95"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#a6d136497581ed553c7c426dfe6997a95">Mirror.NetworkTransformBase.syncPosition</a></div><div class="ttdeci">bool syncPosition</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00045">NetworkTransformBase.cs:45</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_a78d6a03bf153a3fb4af360b7cfc502d5"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#a78d6a03bf153a3fb4af360b7cfc502d5">Mirror.NetworkTransformBase.GetRotation</a></div><div class="ttdeci">virtual Quaternion GetRotation()</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_a81910dd9c1d873404027f5dc57e3afe3"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#a81910dd9c1d873404027f5dc57e3afe3">Mirror.NetworkTransformBase.onlySyncOnChange</a></div><div class="ttdeci">bool onlySyncOnChange</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00051">NetworkTransformBase.cs:51</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_a94fc8ba8f1df542c4a88a77a7889308a"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#a94fc8ba8f1df542c4a88a77a7889308a">Mirror.NetworkTransformBase.GetScale</a></div><div class="ttdeci">virtual Vector3 GetScale()</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_aa1fc84eef8318eb43ea7bf08c0fcf321"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#aa1fc84eef8318eb43ea7bf08c0fcf321">Mirror.NetworkTransformBase.AddSnapshot</a></div><div class="ttdeci">void AddSnapshot(SortedList&lt; double, TransformSnapshot &gt; snapshots, double timeStamp, Vector3? position, Quaternion? rotation, Vector3? scale)</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00181">NetworkTransformBase.cs:181</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_aa7551af797a7a8259d6a0c4c955d68a2"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#aa7551af797a7a8259d6a0c4c955d68a2">Mirror.NetworkTransformBase.syncScale</a></div><div class="ttdeci">bool syncScale</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00047">NetworkTransformBase.cs:47</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_ab0869dec560d1ebc82080f9767cd96b1"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#ab0869dec560d1ebc82080f9767cd96b1">Mirror.NetworkTransformBase.serverSnapshots</a></div><div class="ttdeci">readonly SortedList&lt; double, TransformSnapshot &gt; serverSnapshots</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00041">NetworkTransformBase.cs:41</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_ab273ae81f6a8332c6a4ac08dbf18822b"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#ab273ae81f6a8332c6a4ac08dbf18822b">Mirror.NetworkTransformBase.clientSnapshots</a></div><div class="ttdeci">readonly SortedList&lt; double, TransformSnapshot &gt; clientSnapshots</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00040">NetworkTransformBase.cs:40</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_ab7e0831638765f17e9800e1b0dc7091a"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#ab7e0831638765f17e9800e1b0dc7091a">Mirror.NetworkTransformBase.compressRotation</a></div><div class="ttdeci">bool compressRotation</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00053">NetworkTransformBase.cs:53</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_acc612b7a23024468e277827908a66567"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#acc612b7a23024468e277827908a66567">Mirror.NetworkTransformBase.syncRotation</a></div><div class="ttdeci">bool syncRotation</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00046">NetworkTransformBase.cs:46</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_ae025bfcb11990f490476aa343f5eda04"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#ae025bfcb11990f490476aa343f5eda04">Mirror.NetworkTransformBase.IsClientWithAuthority</a></div><div class="ttdeci">bool IsClientWithAuthority</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00037">NetworkTransformBase.cs:37</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_af478591af670f347ce0b760de2163c48"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#af478591af670f347ce0b760de2163c48">Mirror.NetworkTransformBase.offset</a></div><div class="ttdeci">double offset</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00093">NetworkTransformBase.cs:93</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_base_html_af752efb0bc69a9d09219a293ea680f0d"><div class="ttname"><a href="class_mirror_1_1_network_transform_base.html#af752efb0bc69a9d09219a293ea680f0d">Mirror.NetworkTransformBase.Construct</a></div><div class="ttdeci">virtual TransformSnapshot Construct()</div><div class="ttdef"><b>Definition</b> <a href="_network_transform_base_8cs_source.html#l00168">NetworkTransformBase.cs:168</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html">Mirror.NetworkTransformReliable</a></div><div class="ttdef"><b>Definition</b> <a href="#l00009">NetworkTransformReliable.cs:10</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a0ad06a313f02e169e36f100912810313"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a0ad06a313f02e169e36f100912810313">Mirror.NetworkTransformReliable.lastSerializedScale</a></div><div class="ttdeci">Vector3Long lastSerializedScale</div><div class="ttdef"><b>Definition</b> <a href="#l00038">NetworkTransformReliable.cs:38</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a113c21f24f6482d413a4840f8d89ea9d"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a113c21f24f6482d413a4840f8d89ea9d">Mirror.NetworkTransformReliable.lastClientCount</a></div><div class="ttdeci">int lastClientCount</div><div class="ttdef"><b>Definition</b> <a href="#l00044">NetworkTransformReliable.cs:44</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a1aea8124a3b21bed7e6ec8dd90ec8d11"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a1aea8124a3b21bed7e6ec8dd90ec8d11">Mirror.NetworkTransformReliable.rotationSensitivity</a></div><div class="ttdeci">float rotationSensitivity</div><div class="ttdef"><b>Definition</b> <a href="#l00019">NetworkTransformReliable.cs:19</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a1afcd3d27f5a07ce174d5d73a8055be0"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a1afcd3d27f5a07ce174d5d73a8055be0">Mirror.NetworkTransformReliable.CheckLastSendTime</a></div><div class="ttdeci">virtual void CheckLastSendTime()</div><div class="ttdef"><b>Definition</b> <a href="#l00130">NetworkTransformReliable.cs:130</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a1d11d92f0f3e1990ae06b6216ada6665"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a1d11d92f0f3e1990ae06b6216ada6665">Mirror.NetworkTransformReliable.Changed</a></div><div class="ttdeci">virtual bool Changed(TransformSnapshot current)</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a5bf81733af39600f7e15a29d0554d54b"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a5bf81733af39600f7e15a29d0554d54b">Mirror.NetworkTransformReliable.ResetState</a></div><div class="ttdeci">override void ResetState()</div><div class="ttdef"><b>Definition</b> <a href="#l00405">NetworkTransformReliable.cs:405</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a70a3f649e0dbbd2f8042171ac5d75c09"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a70a3f649e0dbbd2f8042171ac5d75c09">Mirror.NetworkTransformReliable.UpdateClient</a></div><div class="ttdeci">virtual void UpdateClient()</div><div class="ttdef"><b>Definition</b> <a href="#l00104">NetworkTransformReliable.cs:104</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a74ee1ce3dc7409d5b781485db9b23b6e"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a74ee1ce3dc7409d5b781485db9b23b6e">Mirror.NetworkTransformReliable.lastDeserializedPosition</a></div><div class="ttdeci">Vector3Long lastDeserializedPosition</div><div class="ttdef"><b>Definition</b> <a href="#l00036">NetworkTransformReliable.cs:36</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_a878c5147b0b81f564e2d2b776c25745c"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#a878c5147b0b81f564e2d2b776c25745c">Mirror.NetworkTransformReliable.scalePrecision</a></div><div class="ttdeci">float scalePrecision</div><div class="ttdef"><b>Definition</b> <a href="#l00032">NetworkTransformReliable.cs:32</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_aa584b9de7520d4e8482307438552eb4e"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#aa584b9de7520d4e8482307438552eb4e">Mirror.NetworkTransformReliable.QuantizedChanged</a></div><div class="ttdeci">bool QuantizedChanged(Vector3 u, Vector3 v, float precision)</div><div class="ttdef"><b>Definition</b> <a href="#l00157">NetworkTransformReliable.cs:157</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_aa7e13687c2c3322fa8d0de7a648f5927"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#aa7e13687c2c3322fa8d0de7a648f5927">Mirror.NetworkTransformReliable.OnClientToServerSync</a></div><div class="ttdeci">virtual void OnClientToServerSync(Vector3? position, Quaternion? rotation, Vector3? scale)</div><div class="ttdef"><b>Definition</b> <a href="#l00298">NetworkTransformReliable.cs:298</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_aa9ebe89953d5b8f6c4fcfd1101a0d16c"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#aa9ebe89953d5b8f6c4fcfd1101a0d16c">Mirror.NetworkTransformReliable.OnDeserialize</a></div><div class="ttdeci">override void OnDeserialize(NetworkReader reader, bool initialState)</div><div class="ttdoc">Override to do custom deserialization (instead of SyncVars/SyncLists). Use OnSerialize too.</div><div class="ttdef"><b>Definition</b> <a href="#l00241">NetworkTransformReliable.cs:241</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_ab6ec8716b87508bcdc38e95ca28e2314"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#ab6ec8716b87508bcdc38e95ca28e2314">Mirror.NetworkTransformReliable.last</a></div><div class="ttdeci">TransformSnapshot last</div><div class="ttdef"><b>Definition</b> <a href="#l00042">NetworkTransformReliable.cs:42</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_ab9ea63d5c19fc75c87ef01c3c639cfb8"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#ab9ea63d5c19fc75c87ef01c3c639cfb8">Mirror.NetworkTransformReliable.UpdateServer</a></div><div class="ttdeci">virtual void UpdateServer()</div><div class="ttdef"><b>Definition</b> <a href="#l00072">NetworkTransformReliable.cs:72</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_ac27c545389a6998ded75708e00e69089"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#ac27c545389a6998ded75708e00e69089">Mirror.NetworkTransformReliable.onlySyncOnChangeCorrectionMultiplier</a></div><div class="ttdeci">float onlySyncOnChangeCorrectionMultiplier</div><div class="ttdef"><b>Definition</b> <a href="#l00015">NetworkTransformReliable.cs:15</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_ad223d83a739cf988e89fec613e7f14cd"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#ad223d83a739cf988e89fec613e7f14cd">Mirror.NetworkTransformReliable.OnServerToClientSync</a></div><div class="ttdeci">virtual void OnServerToClientSync(Vector3? position, Quaternion? rotation, Vector3? scale)</div><div class="ttdef"><b>Definition</b> <a href="#l00329">NetworkTransformReliable.cs:329</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_ad6b0e608dc0689a392c93a74a7871c72"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#ad6b0e608dc0689a392c93a74a7871c72">Mirror.NetworkTransformReliable.OnSerialize</a></div><div class="ttdeci">override void OnSerialize(NetworkWriter writer, bool initialState)</div><div class="ttdoc">Override to do custom serialization (instead of SyncVars/SyncLists). Use OnDeserialize too.</div><div class="ttdef"><b>Definition</b> <a href="#l00167">NetworkTransformReliable.cs:167</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_addcde9d14bc5cd73a54dfc6fb76385a6"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#addcde9d14bc5cd73a54dfc6fb76385a6">Mirror.NetworkTransformReliable.lastDeserializedScale</a></div><div class="ttdeci">Vector3Long lastDeserializedScale</div><div class="ttdef"><b>Definition</b> <a href="#l00039">NetworkTransformReliable.cs:39</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_afd5d1fb3a64302608ecfdb0850103d03"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#afd5d1fb3a64302608ecfdb0850103d03">Mirror.NetworkTransformReliable.lastSerializedPosition</a></div><div class="ttdeci">Vector3Long lastSerializedPosition</div><div class="ttdef"><b>Definition</b> <a href="#l00035">NetworkTransformReliable.cs:35</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_transform_reliable_html_afdcbc6564979e813341d4426c23a7bf6"><div class="ttname"><a href="class_mirror_1_1_network_transform_reliable.html#afdcbc6564979e813341d4426c23a7bf6">Mirror.NetworkTransformReliable.positionPrecision</a></div><div class="ttdeci">float positionPrecision</div><div class="ttdef"><b>Definition</b> <a href="#l00030">NetworkTransformReliable.cs:30</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_writer_html"><div class="ttname"><a href="class_mirror_1_1_network_writer.html">Mirror.NetworkWriter</a></div><div class="ttdoc">Network Writer for most simple types like floats, ints, buffers, structs, etc. Use NetworkWriterPool....</div><div class="ttdef"><b>Definition</b> <a href="_network_writer_8cs_source.html#l00010">NetworkWriter.cs:11</a></div></div>
<div class="ttc" id="anamespace_mirror_html"><div class="ttname"><a href="namespace_mirror.html">Mirror</a></div><div class="ttdef"><b>Definition</b> <a href="_basic_authenticator_8cs_source.html#l00005">BasicAuthenticator.cs:6</a></div></div>
<div class="ttc" id="anamespace_mirror_html_a3a4f3784dd23e16377d46532b14bae88"><div class="ttname"><a href="namespace_mirror.html#a3a4f3784dd23e16377d46532b14bae88">Mirror.SyncDirection</a></div><div class="ttdeci">SyncDirection</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00019">NetworkBehaviour.cs:19</a></div></div>
<div class="ttc" id="anamespace_mirror_html_ae89dcc4d1b24e073ba6ee149d1c08f42"><div class="ttname"><a href="namespace_mirror.html#ae89dcc4d1b24e073ba6ee149d1c08f42">Mirror.Changed</a></div><div class="ttdeci">Changed</div><div class="ttdef"><b>Definition</b> <a href="_transform_sync_data_8cs_source.html#l00045">TransformSyncData.cs:46</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_grid2_d_html"><div class="ttname"><a href="struct_mirror_1_1_grid2_d.html">Mirror.Grid2D</a></div><div class="ttdef"><b>Definition</b> <a href="_grid2_d_8cs_source.html#l00010">Grid2D.cs:11</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_transform_snapshot_html"><div class="ttname"><a href="struct_mirror_1_1_transform_snapshot.html">Mirror.TransformSnapshot</a></div><div class="ttdef"><b>Definition</b> <a href="_transform_snapshot_8cs_source.html#l00009">TransformSnapshot.cs:10</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_transform_snapshot_html_a1ee6d6dbe34e79d5dc31cc483eaf69d9"><div class="ttname"><a href="struct_mirror_1_1_transform_snapshot.html#a1ee6d6dbe34e79d5dc31cc483eaf69d9">Mirror.TransformSnapshot.position</a></div><div class="ttdeci">Vector3 position</div><div class="ttdef"><b>Definition</b> <a href="_transform_snapshot_8cs_source.html#l00032">TransformSnapshot.cs:32</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_transform_snapshot_html_a6532d3f99fa1174b67e46993d9b731e3"><div class="ttname"><a href="struct_mirror_1_1_transform_snapshot.html#a6532d3f99fa1174b67e46993d9b731e3">Mirror.TransformSnapshot.Interpolate</a></div><div class="ttdeci">static TransformSnapshot Interpolate(TransformSnapshot from, TransformSnapshot to, double t)</div><div class="ttdef"><b>Definition</b> <a href="_transform_snapshot_8cs_source.html#l00045">TransformSnapshot.cs:45</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_transform_snapshot_html_aa80a6912f2cfcaf5ea643899b431a8b2"><div class="ttname"><a href="struct_mirror_1_1_transform_snapshot.html#aa80a6912f2cfcaf5ea643899b431a8b2">Mirror.TransformSnapshot.scale</a></div><div class="ttdeci">Vector3 scale</div><div class="ttdef"><b>Definition</b> <a href="_transform_snapshot_8cs_source.html#l00034">TransformSnapshot.cs:34</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_transform_snapshot_html_ad584289d664a198557a7008a7fde11fe"><div class="ttname"><a href="struct_mirror_1_1_transform_snapshot.html#ad584289d664a198557a7008a7fde11fe">Mirror.TransformSnapshot.rotation</a></div><div class="ttdeci">Quaternion rotation</div><div class="ttdef"><b>Definition</b> <a href="_transform_snapshot_8cs_source.html#l00033">TransformSnapshot.cs:33</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_transform_snapshot_html_ad863b1495c27b43d1c94598ac255653a"><div class="ttname"><a href="struct_mirror_1_1_transform_snapshot.html#ad863b1495c27b43d1c94598ac255653a">Mirror.TransformSnapshot.remoteTime</a></div><div class="ttdeci">double remoteTime</div><div class="ttdef"><b>Definition</b> <a href="_transform_snapshot_8cs_source.html#l00026">TransformSnapshot.cs:26</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_vector3_long_html"><div class="ttname"><a href="struct_mirror_1_1_vector3_long.html">Mirror.Vector3Long</a></div><div class="ttdef"><b>Definition</b> <a href="_vector3_long_8cs_source.html#l00010">Vector3Long.cs:11</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_vector3_long_html_a9b6aaa4cc33903fb32330d320cb97631"><div class="ttname"><a href="struct_mirror_1_1_vector3_long.html#a9b6aaa4cc33903fb32330d320cb97631">Mirror.Vector3Long.zero</a></div><div class="ttdeci">static readonly Vector3Long zero</div><div class="ttdef"><b>Definition</b> <a href="_vector3_long_8cs_source.html#l00016">Vector3Long.cs:16</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_84bbf7b3c7f28a5a18725745e1505219.html">Assets</a></li><li class="navelem"><a class="el" href="dir_bf1dd3994e8f933eb733da65a1863113.html">Mirror</a></li><li class="navelem"><a class="el" href="dir_5065f1081954be9815f50aa7556b37df.html">Components</a></li><li class="navelem"><a class="el" href="dir_487319febf81bc846eb072fe46ed7056.html">NetworkTransform</a></li><li class="navelem"><a class="el" href="_network_transform_reliable_8cs.html">NetworkTransformReliable.cs</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
