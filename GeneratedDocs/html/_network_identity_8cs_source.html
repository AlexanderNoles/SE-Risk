<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>World Conquest: Assets/Mirror/Core/NetworkIdentity.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">World Conquest
   </div>
   <div id="projectbrief">Implementation of the Risk board game for our Software Engineering module.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_network_identity_8cs_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">NetworkIdentity.cs</div></div>
</div><!--header-->
<div class="contents">
<a href="_network_identity_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="keyword">using </span>System;</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">using </span>System.Collections.Generic;</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">using </span>System.Runtime.CompilerServices;</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">using </span><a class="code hl_namespace" href="namespace_mirror_1_1_remote_calls.html">Mirror.RemoteCalls</a>;</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">using </span>UnityEngine;</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">using </span>UnityEngine.Serialization;</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#if UNITY_EDITOR</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="keyword">using </span>UnityEditor;</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#if UNITY_2021_2_OR_NEWER</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="keyword">using </span>UnityEditor.SceneManagement;</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="keyword">using </span>UnityEditor.Experimental.SceneManagement;</div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespace_mirror.html">Mirror</a></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>{</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>    <span class="comment">// Default = use interest management</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    <span class="comment">// ForceHidden = useful to hide monsters while they respawn etc.</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>    <span class="comment">// ForceShown = useful to have score NetworkIdentities that always broadcast</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>    <span class="comment">//              to everyone etc.</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno"><a class="line" href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3d">   24</a></span>    <span class="keyword">public</span> <span class="keyword">enum</span> <a class="code hl_enumeration" href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3d">Visibility</a> { <a class="code hl_enumvalue" href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3da7a1920d61156abc05a60135aefe8bc67">Default</a>, <a class="code hl_enumvalue" href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3da78465833955440db1dedfdcc22b526a5">ForceHidden</a>, <a class="code hl_enumvalue" href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3daa064898d00f046114c4b0e0d4c122fad">ForceShown</a> }</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="foldopen" id="foldopen00026" data-start="{" data-end="};">
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="struct_mirror_1_1_network_identity_serialization.html">   26</a></span>    <span class="keyword">public</span> <span class="keyword">struct </span><a class="code hl_struct" href="struct_mirror_1_1_network_identity_serialization.html">NetworkIdentitySerialization</a></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>    {</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>        <span class="comment">// IMPORTANT: int tick avoids floating point inaccuracy over days/weeks</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="struct_mirror_1_1_network_identity_serialization.html#ad524e39c20b0ab0cd3571c058c3d2147">   29</a></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code hl_variable" href="struct_mirror_1_1_network_identity_serialization.html#ad524e39c20b0ab0cd3571c058c3d2147">tick</a>;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno"><a class="line" href="struct_mirror_1_1_network_identity_serialization.html#a043b57d91ce42b27a090ac150c9549f8">   30</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_mirror_1_1_network_writer.html">NetworkWriter</a> <a class="code hl_variable" href="struct_mirror_1_1_network_identity_serialization.html#a043b57d91ce42b27a090ac150c9549f8">ownerWriter</a>;</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno"><a class="line" href="struct_mirror_1_1_network_identity_serialization.html#a1ca907f82f448de8d32d5e4d57252e96">   31</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_mirror_1_1_network_writer.html">NetworkWriter</a> <a class="code hl_variable" href="struct_mirror_1_1_network_identity_serialization.html#a1ca907f82f448de8d32d5e4d57252e96">observersWriter</a>;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>    }</div>
</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">DisallowMultipleComponent</a>]</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    <span class="comment">// NetworkIdentity.Awake initializes all NetworkComponents.</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    <span class="comment">// let&#39;s make sure it&#39;s always called before their Awake&#39;s.</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">DefaultExecutionOrder</a>(-1)]</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AddComponentMenu</a>(<span class="stringliteral">&quot;Network/Network Identity&quot;</span>)]</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">HelpURL</a>(<span class="stringliteral">&quot;https://mirror-networking.gitbook.io/docs/components/network-identity&quot;</span>)]</div>
<div class="foldopen" id="foldopen00041" data-start="{" data-end="};">
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html">   41</a></span>    <span class="keyword">public</span> <span class="keyword">sealed</span> <span class="keyword">class </span><a class="code hl_class" href="class_mirror_1_1_network_identity.html">NetworkIdentity</a> : MonoBehaviour</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    {</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>        <span class="comment">// IMPORTANT:</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>        <span class="comment">//   OnStartClient sets it to true. we NEVER set it to false after.</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>        <span class="comment">//   otherwise components like Skillbars couldn&#39;t use OnDestroy()</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        <span class="comment">//   for saving, etc. since isClient may have been reset before</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        <span class="comment">//   OnDestroy was called.</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>        <span class="comment">//   we also DO NOT make it dependent on NetworkClient.active or similar.</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>        <span class="comment">//   we set it, then never change it. that&#39;s the user&#39;s expectation too.</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>        <span class="comment">//   =&gt; fixes https://github.com/vis2k/Mirror/issues/1475</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a0a3bb71dd8fc37492957fe1bdbb7955e">   55</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a0a3bb71dd8fc37492957fe1bdbb7955e">isClient</a> { <span class="keyword">get</span>; <span class="keyword">internal</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>        <span class="comment">// IMPORTANT:</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>        <span class="comment">//   OnStartServer sets it to true. we NEVER set it to false after.</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="comment">//   otherwise components like Skillbars couldn&#39;t use OnDestroy()</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>        <span class="comment">//   for saving, etc. since isServer may have been reset before</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        <span class="comment">//   OnDestroy was called.</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        <span class="comment">//   we also DO NOT make it dependent on NetworkServer.active or similar.</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>        <span class="comment">//   we set it, then never change it. that&#39;s the user&#39;s expectation too.</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>        <span class="comment">//   =&gt; fixes https://github.com/vis2k/Mirror/issues/1484</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>        <span class="comment">//   =&gt; fixes https://github.com/vis2k/Mirror/issues/2533</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">   70</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">isServer</a> { <span class="keyword">get</span>; <span class="keyword">internal</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        <span class="comment">// IMPORTANT:</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>        <span class="comment">//   OnStartLocalPlayer sets it to true. we NEVER set it to false after.</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        <span class="comment">//   otherwise components like Skillbars couldn&#39;t use OnDestroy()</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        <span class="comment">//   for saving, etc. since isLocalPlayer may have been reset before</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        <span class="comment">//   OnDestroy was called.</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>        <span class="comment">//   we also DO NOT make it dependent on NetworkClient.localPlayer or similar.</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        <span class="comment">//   we set it, then never change it. that&#39;s the user&#39;s expectation too.</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        <span class="comment">//   =&gt; fixes https://github.com/vis2k/Mirror/issues/2615</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a7224507781dad1ac9cb724242cf3a653">   84</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a7224507781dad1ac9cb724242cf3a653">isLocalPlayer</a> { <span class="keyword">get</span>; <span class="keyword">internal</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#aa50d597abe0b493dcacbce7856b4f03a">   87</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#aa50d597abe0b493dcacbce7856b4f03a">isServerOnly</a> =&gt; <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">isServer</a> &amp;&amp; !<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a0a3bb71dd8fc37492957fe1bdbb7955e">isClient</a>;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#ac5077f1ab1d5e360e1a4dd29b319f4d0">   90</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#ac5077f1ab1d5e360e1a4dd29b319f4d0">isClientOnly</a> =&gt; <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a0a3bb71dd8fc37492957fe1bdbb7955e">isClient</a> &amp;&amp; !<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">isServer</a>;</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>        <span class="comment">// for example: main player &amp; pets are owned. monsters &amp; npcs aren&#39;t.</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a91ce5068c8b40a1479fe0e6cd7ea9a17">   94</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a91ce5068c8b40a1479fe0e6cd7ea9a17">isOwned</a> { <span class="keyword">get</span>; <span class="keyword">internal</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span> </div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>        <span class="comment">// internal so NetworkManager can reset it from StopClient.</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>        <span class="keyword">internal</span> <span class="keywordtype">bool</span> clientStarted;</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">  100</a></span>        <span class="keyword">public</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">readonly</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Dictionary&lt;int, NetworkConnectionToClient&gt;</a> <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">observers</a> =</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>            <span class="keyword">new</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Dictionary&lt;int, NetworkConnectionToClient&gt;</a>();</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a3752b290380dc9ec029ddd86af8dc206">  104</a></span>        <span class="keyword">public</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a3752b290380dc9ec029ddd86af8dc206">netId</a> { <span class="keyword">get</span>; <span class="keyword">internal</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>        <span class="comment">// persistent scene id &lt;sceneHash/32,sceneId/32&gt; (see AssignSceneID comments)</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">FormerlySerializedAs</a>(<span class="stringliteral">&quot;m_SceneId&quot;</span>), <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">HideInInspector</a>]</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">  109</a></span>        <span class="keyword">public</span> ulong <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a>;</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>        <span class="comment">// assetId used to spawn prefabs across the network.</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>        <span class="comment">// originally a Guid, but a 4 byte uint is sufficient</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>        <span class="comment">// (as suggested by james)</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>        <span class="comment">// it&#39;s also easier to work with for serialization etc.</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>        <span class="comment">// serialized and visible in inspector for easier debugging</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">SerializeField</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">HideInInspector</a>] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> _assetId;</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>        <span class="comment">// The AssetId trick:</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>        <span class="comment">//   Ideally we would have a serialized &#39;Guid m_AssetId&#39; but Unity can&#39;t</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>        <span class="comment">//   serialize it because Guid&#39;s internal bytes are private</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        <span class="comment">//   Using just the Guid string would work, but it&#39;s 32 chars long and</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        <span class="comment">//   would then be sent over the network as 64 instead of 16 bytes</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>        <span class="comment">// =&gt; The solution is to serialize the string internally here and then</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>        <span class="comment">//    use the real &#39;Guid&#39; type for everything else via .assetId</span></div>
<div class="foldopen" id="foldopen00128" data-start="{" data-end="};">
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#aa04b8f2d8340b68f027b511e5fe86949">  128</a></span>        <span class="keyword">public</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#aa04b8f2d8340b68f027b511e5fe86949">assetId</a></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>        {</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            <span class="keyword">get</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>            {</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="preprocessor">#if UNITY_EDITOR</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>                <span class="comment">// old UNET comment:</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>                <span class="comment">// This is important because sometimes OnValidate does not run</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>                <span class="comment">// (like when adding NetworkIdentity to prefab with no child links)</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>                <span class="keywordflow">if</span> (_assetId == 0)</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">SetupIDs</a>();</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>                <span class="keywordflow">return</span> _assetId;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>            }</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>            <span class="comment">// assetId is set internally when creating or duplicating a prefab</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>            <span class="keyword">internal</span> <span class="keyword">set</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>            {</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>                <span class="comment">// should never be empty</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>                <span class="keywordflow">if</span> (value == 0)</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                {</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;Can not set AssetId to empty guid on NetworkIdentity &#39;{name}&#39;, old assetId &#39;{_assetId}&#39;&quot;</span>);</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                <span class="comment">// always set it otherwise.</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>                <span class="comment">// for new prefabs,        it will set from 0 to N.</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                <span class="comment">// for duplicated prefabs, it will set from N to M.</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>                <span class="comment">// either way, it&#39;s always set to a valid GUID.</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>                _assetId = value;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>                <span class="comment">// Debug.Log($&quot;Setting AssetId on NetworkIdentity &#39;{name}&#39;, new assetId &#39;{value:X4}&#39;&quot;);</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>            }</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>        }</div>
</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">FormerlySerializedAs</a>(<span class="stringliteral">&quot;m_ServerOnly&quot;</span>)]</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Tooltip</a>(<span class="stringliteral">&quot;Prevents this object from being spawned / enabled on clients&quot;</span>)]</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a2b90032cea75219737de4aab7ac8ecc6">  163</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a2b90032cea75219737de4aab7ac8ecc6">serverOnly</a>;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <span class="comment">// Set before Destroy is called so that OnDestroy doesn&#39;t try to destroy</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <span class="comment">// the object again</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        <span class="keyword">internal</span> <span class="keywordtype">bool</span> destroyCalled;</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>        <span class="comment">// TODO change to NetworkConnectionToServer, but might cause some breaking</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#afddec2dc92f3f98b1755937d9fd1430e">  171</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_mirror_1_1_network_connection.html">NetworkConnection</a> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#afddec2dc92f3f98b1755937d9fd1430e">connectionToServer</a> { <span class="keyword">get</span>; <span class="keyword">internal</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="foldopen" id="foldopen00174" data-start="{" data-end="};">
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">  174</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        {</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>            <span class="keyword">get</span> =&gt; _connectionToClient;</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>            <span class="keyword">internal</span> <span class="keyword">set</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>            {</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                _connectionToClient?.RemoveOwnedObject(<span class="keyword">this</span>);</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>                _connectionToClient = value;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>                _connectionToClient?.AddOwnedObject(<span class="keyword">this</span>);</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>            }</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>        }</div>
</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        <a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> _connectionToClient;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span> </div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <span class="comment">// get all NetworkBehaviour components</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">  187</a></span>        <span class="keyword">public</span> <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a>[] <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a> { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>        <span class="comment">// to save bandwidth, we send one 64 bit dirty mask</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        <span class="comment">// instead of 1 byte index per dirty component.</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        <span class="comment">// which means we can&#39;t allow &gt; 64 components (it&#39;s enough).</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> MaxNetworkBehaviours = 64;</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span> </div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        <span class="comment">// current visibility</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        <span class="comment">// Default = use interest management</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        <span class="comment">// ForceHidden = useful to hide monsters while they respawn etc.</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        <span class="comment">// ForceShown = useful to have score NetworkIdentities that always broadcast</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        <span class="comment">//              to everyone etc.</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Tooltip</a>(<span class="stringliteral">&quot;Visibility can overwrite interest management. ForceHidden can be useful to hide monsters while they respawn. ForceShown can be useful for score NetworkIdentities that should always broadcast to everyone in the world.&quot;</span>)]</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">FormerlySerializedAs</a>(<span class="stringliteral">&quot;visible&quot;</span>)]</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#adc838564b39c994bd75cd40df9af1c1c">  202</a></span>        <span class="keyword">public</span> <a class="code hl_enumeration" href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3d">Visibility</a> <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#adc838564b39c994bd75cd40df9af1c1c">visibility</a> = <a class="code hl_enumeration" href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3d">Visibility</a>.Default;</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>        <span class="comment">// Deprecated 2024-01-21</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">HideInInspector</a>]</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Obsolete</a>(<span class="stringliteral">&quot;Deprecated - Use .visibility instead. This will be removed soon.&quot;</span>)]</div>
<div class="foldopen" id="foldopen00207" data-start="{" data-end="};">
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#acc43e5ce83c61b1dc738afe5ad3c6ef3">  207</a></span>        <span class="keyword">public</span> <a class="code hl_enumeration" href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3d">Visibility</a> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#acc43e5ce83c61b1dc738afe5ad3c6ef3">visible</a></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        {</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>            <span class="keyword">get</span> =&gt; <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#adc838564b39c994bd75cd40df9af1c1c">visibility</a>;</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>            <span class="keyword">set</span> =&gt; <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#adc838564b39c994bd75cd40df9af1c1c">visibility</a> = value;</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>        }</div>
</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span> </div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        <span class="comment">// broadcasting serializes all entities around a player for each player.</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        <span class="comment">// we don&#39;t want to serialize one entity twice in the same tick.</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        <span class="comment">// so we cache the last serialization and remember the timestamp so we</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        <span class="comment">// know which Update it was serialized.</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>        <span class="comment">// (timestamp is the same while inside Update)</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        <span class="comment">// =&gt; this way we don&#39;t need to pool thousands of writers either.</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        <span class="comment">// =&gt; way easier to store them per object</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>        <a class="code hl_struct" href="struct_mirror_1_1_network_identity_serialization.html">NetworkIdentitySerialization</a> lastSerialization = <span class="keyword">new</span> <a class="code hl_struct" href="struct_mirror_1_1_network_identity_serialization.html">NetworkIdentitySerialization</a></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        {</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>            ownerWriter = <span class="keyword">new</span> <a class="code hl_class" href="class_mirror_1_1_network_writer.html">NetworkWriter</a>(),</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>            observersWriter = <span class="keyword">new</span> <a class="code hl_class" href="class_mirror_1_1_network_writer.html">NetworkWriter</a>()</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>        };</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span> </div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>        <span class="comment">// Keep track of all sceneIds to detect scene duplicates</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        <span class="keyword">static</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">readonly</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Dictionary&lt;ulong, NetworkIdentity&gt;</a> sceneIds =</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>            <span class="keyword">new</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Dictionary&lt;ulong, NetworkIdentity&gt;</a>();</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span> </div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        <span class="comment">// Helper function to handle Command/Rpc</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> HandleRemoteCall(<span class="keywordtype">byte</span> componentIndex, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ushort</a> functionHash, <a class="code hl_enumeration" href="namespace_mirror_1_1_remote_calls.html#aa6f151e63d93761510b1a8fffc797bfb">RemoteCallType</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">remoteCallType</a>, <a class="code hl_class" href="class_mirror_1_1_network_reader.html">NetworkReader</a> reader, <a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">senderConnection</a> = <span class="keyword">null</span>)</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        {</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>            <span class="comment">// check if unity object has been destroyed</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>            <span class="keywordflow">if</span> (<span class="keyword">this</span> == <span class="keyword">null</span>)</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            {</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogWarning(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;{remoteCallType} [{functionHash}] received for deleted object [netId={netId}]&quot;</span>);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>            }</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>            <span class="comment">// find the right component to invoke the function on</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>            <span class="keywordflow">if</span> (componentIndex &gt;= <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>.Length)</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>            {</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogWarning(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;Component [{componentIndex}] not found for [netId={netId}]&quot;</span>);</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>            }</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>            <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">invokeComponent</a> = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>[componentIndex];</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>            <span class="keywordflow">if</span> (!RemoteProcedureCalls.Invoke(functionHash, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">remoteCallType</a>, reader, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">invokeComponent</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">senderConnection</a>))</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            {</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;Found no receiver for incoming {remoteCallType} [{functionHash}] on {gameObject.name}, the server and client should have the same NetworkBehaviour instances [netId={netId}].&quot;</span>);</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>            }</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        }</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>        <span class="comment">// RuntimeInitializeOnLoadMethod -&gt; fast playmode without domain reload</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        <span class="comment">// internal so it can be called from NetworkServer &amp; NetworkClient</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">RuntimeInitializeOnLoadMethod</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">RuntimeInitializeLoadType</a>.BeforeSceneLoad)]</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keywordtype">void</span> ResetStatics()</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>        {</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            <span class="comment">// reset ALL statics</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            ResetClientStatics();</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            ResetServerStatics();</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        }</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        <span class="comment">// reset only client sided statics.</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>        <span class="comment">// don&#39;t touch server statics when calling StopClient in host mode.</span></div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        <span class="comment">// https://github.com/vis2k/Mirror/issues/2954</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keywordtype">void</span> ResetClientStatics()</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>        {</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>            previousLocalPlayer = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>            <a class="code hl_event" href="class_mirror_1_1_network_identity.html#aba3975b546ad171d59ed0d4e0d15c3eb">clientAuthorityCallback</a> = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>        }</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>        <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keywordtype">void</span> ResetServerStatics()</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>            nextNetworkId = 1;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        }</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a030154e28b95e17a15de62707f0006e3">  279</a></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code hl_class" href="class_mirror_1_1_network_identity.html">NetworkIdentity</a> <a class="code hl_function" href="class_mirror_1_1_network_identity.html#a030154e28b95e17a15de62707f0006e3">GetSceneIdentity</a>(ulong <span class="keywordtype">id</span>) =&gt; sceneIds[<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">id</a>];</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>        <span class="keyword">static</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> nextNetworkId = 1;</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        <span class="keyword">internal</span> <span class="keyword">static</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> GetNextNetworkId() =&gt; nextNetworkId++;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#af6af44b5090bf3d6e146440262b12d0f">  285</a></span>        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_identity.html#af6af44b5090bf3d6e146440262b12d0f">ResetNextNetworkId</a>() =&gt; nextNetworkId = 1;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span> </div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#aee37405a63cd24c7a2d5dedb752b918c">  288</a></span>        <span class="keyword">public</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">delegate</a> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_identity.html#aee37405a63cd24c7a2d5dedb752b918c">ClientAuthorityCallback</a>(<a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> conn, <a class="code hl_class" href="class_mirror_1_1_network_identity.html">NetworkIdentity</a> identity, <span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">authorityState</a>);</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span> </div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#aba3975b546ad171d59ed0d4e0d15c3eb">  291</a></span>        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">event</span> <a class="code hl_function" href="class_mirror_1_1_network_identity.html#aee37405a63cd24c7a2d5dedb752b918c">ClientAuthorityCallback</a> <a class="code hl_event" href="class_mirror_1_1_network_identity.html#aba3975b546ad171d59ed0d4e0d15c3eb">clientAuthorityCallback</a>;</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        <span class="comment">// hasSpawned should always be false before runtime</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">SerializeField</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">HideInInspector</a>] <span class="keywordtype">bool</span> hasSpawned;</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a26902bfccbd86c890cebfc37bfc77d6d">  295</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a26902bfccbd86c890cebfc37bfc77d6d">SpawnedFromInstantiate</a> { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span> </div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        <span class="comment">// NetworkBehaviour components are initialized in Awake once.</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        <span class="comment">// Changing them at runtime would get client &amp; server out of sync.</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>        <span class="comment">// BUT internal so tests can add them after creating the NetworkIdentity</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> InitializeNetworkBehaviours()</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>        {</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>            <span class="comment">// Get all NetworkBehaviour components, including children.</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>            <span class="comment">// Some users need NetworkTransform on child bones, etc.</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>            <span class="comment">// =&gt; Deterministic: https://forum.unity.com/threads/getcomponentsinchildren.4582/#post-33983</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>            <span class="comment">// =&gt; Never null. GetComponents returns [] if none found.</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>            <span class="comment">// =&gt; Include inactive. We need all child components.</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">GetComponentsInChildren&lt;NetworkBehaviour&gt;</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>            ValidateComponents();</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            <span class="comment">// initialize each one</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> = 0; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> &lt; <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>.Length; ++<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>)</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>            {</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>                <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> component = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>[<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>];</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>                component.netIdentity = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>                component.ComponentIndex = (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">byte</a>)<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>            }</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>        }</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        <span class="keywordtype">void</span> ValidateComponents()</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        {</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a> == <span class="keyword">null</span>)</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            {</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;NetworkBehaviours array is null on {gameObject.name}!\n&quot;</span> +</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;Typically this can happen when a networked object is a child of a &quot;</span> +</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;non-networked parent that&#39;s disabled, preventing Awake on the networked object &quot;</span> +</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;from being invoked, where the NetworkBehaviours array is initialized.&quot;</span>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>);</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>            }</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>.Length &gt; MaxNetworkBehaviours)</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>            {</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;NetworkIdentity {name} has too many NetworkBehaviour components: only {MaxNetworkBehaviours} NetworkBehaviour components are allowed in order to save bandwidth.&quot;</span>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>            }</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>        }</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>        <span class="comment">// Awake is only called in Play mode.</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>        <span class="comment">// internal so we can call it during unit tests too.</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> Awake()</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>        {</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>            <span class="comment">// initialize NetworkBehaviour components.</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>            <span class="comment">// Awake() is called immediately after initialization.</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>            <span class="comment">// no one can overwrite it because NetworkIdentity is sealed.</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>            <span class="comment">// =&gt; doing it here is the fastest and easiest solution.</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>            InitializeNetworkBehaviours();</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>            <span class="keywordflow">if</span> (hasSpawned)</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>            {</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;{name} has already spawned. Don&#39;t call Instantiate for NetworkIdentities that were in the scene since the beginning (aka scene objects).  Otherwise the client won&#39;t know which object to use for a SpawnSceneObject message.&quot;</span>);</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>                <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a26902bfccbd86c890cebfc37bfc77d6d">SpawnedFromInstantiate</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>                Destroy(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>);</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            }</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            hasSpawned = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        }</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>        <span class="keywordtype">void</span> OnValidate()</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        {</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>            <span class="comment">// OnValidate is not called when using Instantiate, so we can use</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>            <span class="comment">// it to make sure that hasSpawned is false</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>            hasSpawned = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span><span class="preprocessor">#if UNITY_EDITOR</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">DisallowChildNetworkIdentities</a>();</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">SetupIDs</a>();</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        }</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>        <span class="comment">// expose our AssetId Guid to uint mapping code in case projects need to map Guids to uint as well.</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>        <span class="comment">// this way their projects won&#39;t break if we change our mapping algorithm.</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        <span class="comment">// needs to be available at runtime / builds, don&#39;t wrap in #if UNITY_EDITOR</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#a289174dce0c577d31030fadfeb08d8c9">  368</a></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> <a class="code hl_function" href="class_mirror_1_1_network_identity.html#a289174dce0c577d31030fadfeb08d8c9">AssetGuidToUint</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Guid</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">guid</a>) =&gt; (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a>)<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">guid</a>.GetHashCode(); <span class="comment">// deterministic</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="preprocessor">#if UNITY_EDITOR</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>        <span class="comment">// child NetworkIdentities are not supported.</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        <span class="comment">// Disallow them and show an error for the user to fix.</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        <span class="comment">// This needs to work for Prefabs &amp; Scene objects, so the previous check</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        <span class="comment">// in NetworkClient.RegisterPrefab is not enough.</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>        <span class="keywordtype">void</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">DisallowChildNetworkIdentities</a>()</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>        {</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span><span class="preprocessor">#if UNITY_2020_3_OR_NEWER</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>            <a class="code hl_class" href="class_mirror_1_1_network_identity.html">NetworkIdentity</a>[] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">identities</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">GetComponentsInChildren&lt;NetworkIdentity&gt;</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>            <a class="code hl_class" href="class_mirror_1_1_network_identity.html">NetworkIdentity</a>[] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">identities</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">GetComponentsInChildren&lt;NetworkIdentity&gt;</a>();</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">identities</a>.Length &gt; 1)</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>            {</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                <span class="comment">// always log the next child component so it&#39;s easy to fix.</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>                <span class="comment">// if there are multiple, then after removing it&#39;ll log the next.</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;&#39;{name}&#39; has another NetworkIdentity component on &#39;{identities[1].name}&#39;. There should only be one NetworkIdentity, and it must be on the root object. Please remove the other one.&quot;</span>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>            }</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        }</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>        <span class="keywordtype">void</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignAssetID</a>(<span class="keywordtype">string</span> path)</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>        {</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>            <span class="comment">// only set if not empty. fixes https://github.com/vis2k/Mirror/issues/2765</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>            <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">IsNullOrWhiteSpace</a>(path))</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>            {</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>                <span class="comment">// if we generate the assetId then we MUST be sure to set dirty</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                <span class="comment">// in order to save the prefab object properly. otherwise it</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>                <span class="comment">// would be regenerated every time we reopen the prefab.</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>                <span class="comment">// -&gt; Undo.RecordObject is the new EditorUtility.SetDirty!</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>                <span class="comment">// -&gt; we need to call it before changing.</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>                <span class="comment">//</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>                <span class="comment">// to verify this, duplicate a prefab and double click to open it.</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>                <span class="comment">// add a log message if &quot;_assetId != before_&quot;.</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>                <span class="comment">// without RecordObject, it&#39;ll log every time because it&#39;s not saved.</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Undo</a>.RecordObject(<span class="keyword">this</span>, <span class="stringliteral">&quot;Assigned AssetId&quot;</span>);</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>                <span class="comment">// uint before = _assetId;</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Guid</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">guid</a> = <span class="keyword">new</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Guid</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssetDatabase</a>.AssetPathToGUID(path));</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>                <a class="code hl_property" href="class_mirror_1_1_network_identity.html#aa04b8f2d8340b68f027b511e5fe86949">assetId</a> = <a class="code hl_function" href="class_mirror_1_1_network_identity.html#a289174dce0c577d31030fadfeb08d8c9">AssetGuidToUint</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">guid</a>);</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>                <span class="comment">// if (_assetId != before) Debug.Log($&quot;Assigned assetId={assetId} to {name}&quot;);</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>            }</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        }</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        <span class="keywordtype">void</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignAssetID</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">GameObject</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">prefab</a>) =&gt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignAssetID</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssetDatabase</a>.GetAssetPath(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">prefab</a>));</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        <span class="comment">// persistent sceneId assignment</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        <span class="comment">// (because scene objects have no persistent unique ID in Unity)</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        <span class="comment">// original UNET used OnPostProcessScene to assign an index based on</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        <span class="comment">// FindObjectOfType&lt;NetworkIdentity&gt; order.</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>        <span class="comment">// -&gt; this didn&#39;t work because FindObjectOfType order isn&#39;t deterministic.</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>        <span class="comment">// -&gt; one workaround is to sort them by sibling paths, but it can still</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>        <span class="comment">//    get out of sync when we open scene2 in editor and we have</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>        <span class="comment">//    DontDestroyOnLoad objects that messed with the sibling index.</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        <span class="comment">// we absolutely need a persistent id. challenges:</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>        <span class="comment">// * it needs to be 0 for prefabs</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>        <span class="comment">//   =&gt; we set it to 0 in SetupIDs() if prefab!</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        <span class="comment">// * it needs to be only assigned in edit time, not at runtime because</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>        <span class="comment">//   only the objects that were in the scene since beginning should have</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>        <span class="comment">//   a scene id.</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        <span class="comment">//   =&gt; Application.isPlaying check solves that</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>        <span class="comment">// * it needs to detect duplicated sceneIds after duplicating scene</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        <span class="comment">//   objects</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        <span class="comment">//   =&gt; sceneIds dict takes care of that</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>        <span class="comment">// * duplicating the whole scene file shouldn&#39;t result in duplicate</span></div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>        <span class="comment">//   scene objects</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        <span class="comment">//   =&gt; buildIndex is shifted into sceneId for that.</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <span class="comment">//   =&gt; if we have no scenes in build index then it doesn&#39;t matter</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        <span class="comment">//      because by definition a build can&#39;t switch to other scenes</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        <span class="comment">//   =&gt; if we do have scenes in build index then it will be != -1</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>        <span class="comment">//   note: the duplicated scene still needs to be opened once for it to</span></div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>        <span class="comment">//          be set properly</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>        <span class="comment">// * scene objects need the correct scene index byte even if the scene&#39;s</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>        <span class="comment">//   build index was changed or a duplicated scene wasn&#39;t opened yet.</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        <span class="comment">//   =&gt; OnPostProcessScene is the only function that gets called for</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>        <span class="comment">//      each scene before runtime, so this is where we set the scene</span></div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>        <span class="comment">//      byte.</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        <span class="comment">// * disabled scenes in build settings should result in same scene index</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        <span class="comment">//   in editor and in build</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <span class="comment">//   =&gt; .gameObject.scene.buildIndex filters out disabled scenes by</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        <span class="comment">//      default</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        <span class="comment">// * generated sceneIds absolutely need to set scene dirty and force the</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>        <span class="comment">//   user to resave.</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <span class="comment">//   =&gt; Undo.RecordObject does that perfectly.</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>        <span class="comment">// * sceneIds should never be generated temporarily for unopened scenes</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>        <span class="comment">//   when building, otherwise editor and build get out of sync</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        <span class="comment">//   =&gt; BuildPipeline.isBuildingPlayer check solves that</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>        <span class="keywordtype">void</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignSceneID</a>()</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>        {</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>            <span class="comment">// we only ever assign sceneIds at edit time, never at runtime.</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            <span class="comment">// by definition, only the original scene objects should get one.</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>            <span class="comment">// -&gt; if we assign at runtime then server and client would generate</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>            <span class="comment">//    different random numbers!</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Application</a>.isPlaying)</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span> </div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            <span class="comment">// no valid sceneId yet, or duplicate?</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            <span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">duplicate</a> = sceneIds.TryGetValue(<a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_class" href="class_mirror_1_1_network_identity.html">NetworkIdentity</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">existing</a>) &amp;&amp; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">existing</a> != <span class="keyword">null</span> &amp;&amp; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">existing</a> != <span class="keyword">this</span>;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a> == 0 || <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">duplicate</a>)</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>            {</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>                <span class="comment">// clear in any case, because it might have been a duplicate</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>                <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a> = 0;</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>                <span class="comment">// if a scene was never opened and we are building it, then a</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>                <span class="comment">// sceneId would be assigned to build but not saved in editor,</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>                <span class="comment">// resulting in them getting out of sync.</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>                <span class="comment">// =&gt; don&#39;t ever assign temporary ids. they always need to be</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>                <span class="comment">//    permanent</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>                <span class="comment">// =&gt; throw an exception to cancel the build and let the user</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>                <span class="comment">//    know how to fix it!</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">BuildPipeline</a>.isBuildingPlayer)</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>                    <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">InvalidOperationException</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;Scene {gameObject.scene.path} needs to be opened and resaved before building, because the scene object {name} has no valid sceneId yet.&quot;</span>);</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span> </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>                <span class="comment">// if we generate the sceneId then we MUST be sure to set dirty</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>                <span class="comment">// in order to save the scene object properly. otherwise it</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>                <span class="comment">// would be regenerated every time we reopen the scene, and</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>                <span class="comment">// upgrading would be very difficult.</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>                <span class="comment">// -&gt; Undo.RecordObject is the new EditorUtility.SetDirty!</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>                <span class="comment">// -&gt; we need to call it before changing.</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Undo</a>.RecordObject(<span class="keyword">this</span>, <span class="stringliteral">&quot;Generated SceneId&quot;</span>);</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span> </div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                <span class="comment">// generate random sceneId part (0x00000000FFFFFFFF)</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">randomId</a> = Utils.GetTrueRandomUInt();</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span> </div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>                <span class="comment">// only assign if not a duplicate of an existing scene id</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>                <span class="comment">// (small chance, but possible)</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">duplicate</a> = sceneIds.TryGetValue(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">randomId</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">existing</a>) &amp;&amp; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">existing</a> != <span class="keyword">null</span> &amp;&amp; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">existing</a> != <span class="keyword">this</span>;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>                <span class="keywordflow">if</span> (!<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">duplicate</a>)</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>                {</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>                    <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">randomId</a>;</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>                    <span class="comment">//Debug.Log($&quot;{name} in scene {gameObject.scene.name} sceneId assigned to:{sceneId:X}&quot;);</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>                }</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>            }</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>            <span class="comment">// add to sceneIds dict no matter what</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>            <span class="comment">// -&gt; even if we didn&#39;t generate anything new, because we still need</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>            <span class="comment">//    existing sceneIds in there to check duplicates</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>            sceneIds[<a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a>] = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>        }</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>        <span class="comment">// copy scene path hash into sceneId for scene objects.</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        <span class="comment">// this is the only way for scene file duplication to not contain</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>        <span class="comment">// duplicate sceneIds as it seems.</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>        <span class="comment">// -&gt; sceneId before: 0x00000000AABBCCDD</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>        <span class="comment">// -&gt; then we clear the left 4 bytes, so that our &#39;OR&#39; uses 0x00000000</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>        <span class="comment">// -&gt; then we OR the hash into the 0x00000000 part</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>        <span class="comment">// -&gt; buildIndex is not enough, because Editor and Build have different</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <span class="comment">//    build indices if there are disabled scenes in build settings, and</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        <span class="comment">//    if no scene is in build settings then Editor and Build have</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>        <span class="comment">//    different indices too (Editor=0, Build=-1)</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>        <span class="comment">// =&gt; ONLY USE THIS FROM POSTPROCESSSCENE!</span></div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">SetSceneIdSceneHashPartInternal</a>()</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        {</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>            <span class="comment">// Use `ToLower` to that because BuildPipeline.BuildPlayer is case insensitive but hash is case sensitive</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>            <span class="comment">// If the scene in the project is `forest.unity` but `Forest.unity` is given to BuildPipeline then the</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>            <span class="comment">// BuildPipeline will use `Forest.unity` for the build and create a different hash than the editor will.</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>            <span class="comment">// Using ToLower will mean the hash will be the same for these 2 paths</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>            <span class="comment">// Assets/Scenes/Forest.unity</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>            <span class="comment">// Assets/Scenes/forest.unity</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>            <span class="keywordtype">string</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">scenePath</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>.scene.path.ToLower();</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>            <span class="comment">// get deterministic scene hash</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">pathHash</a> = (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">uint</a>)<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">scenePath</a>.GetStableHashCode();</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span> </div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>            <span class="comment">// shift hash from 0x000000FFFFFFFF to 0xFFFFFFFF00000000</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>            ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">shiftedHash</a> = (ulong)<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">pathHash</a> &lt;&lt; 32;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>            <span class="comment">// OR into scene id</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>            <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a> = (<a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a> &amp; 0xFFFFFFFF) | <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">shiftedHash</a>;</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>            <span class="comment">// log it. this is incredibly useful to debug sceneId issues.</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>            <span class="comment">//Debug.Log($&quot;{name} in scene {gameObject.scene.name} scene index hash {pathHash:X} copied into sceneId {sceneId:X}&quot;);</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>        }</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span> </div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>        <span class="keywordtype">void</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">SetupIDs</a>()</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>        {</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>            <span class="comment">// is this a prefab?</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>            <span class="keywordflow">if</span> (Utils.IsPrefab(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>))</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>            {</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>                <span class="comment">// force 0 for prefabs</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>                <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a> = 0;</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignAssetID</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>);</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>            }</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>            <span class="comment">// are we currently in prefab editing mode? aka prefab stage</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>            <span class="comment">// =&gt; check prefabstage BEFORE SceneObjectWithPrefabParent</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>            <span class="comment">//    (fixes https://github.com/vis2k/Mirror/issues/976)</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>            <span class="comment">// =&gt; if we don&#39;t check GetCurrentPrefabStage and only check</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>            <span class="comment">//    GetPrefabStage(gameObject), then the &#39;else&#39; case where we</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>            <span class="comment">//    assign a sceneId and clear the assetId would still be</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>            <span class="comment">//    triggered for prefabs. in other words: if we are in prefab</span></div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>            <span class="comment">//    stage, do not bother with anything else ever!</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">PrefabStageUtility</a>.GetCurrentPrefabStage() != <span class="keyword">null</span>)</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>            {</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>                <span class="comment">// when modifying a prefab in prefab stage, Unity calls</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>                <span class="comment">// OnValidate for that prefab and for all scene objects based on</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>                <span class="comment">// that prefab.</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>                <span class="comment">//</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>                <span class="comment">// is this GameObject the prefab that we modify, and not just a</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>                <span class="comment">// scene object based on the prefab?</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>                <span class="comment">//   * GetCurrentPrefabStage = &#39;are we editing ANY prefab?&#39;</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>                <span class="comment">//   * GetPrefabStage(go) = &#39;are we editing THIS prefab?&#39;</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>                <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">PrefabStageUtility</a>.GetPrefabStage(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>) != <span class="keyword">null</span>)</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>                {</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>                    <span class="comment">// force 0 for prefabs</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>                    <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">sceneId</a> = 0;</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>                    <span class="comment">//Debug.Log($&quot;{name} scene:{gameObject.scene.name} sceneid reset to 0 because CurrentPrefabStage={PrefabStageUtility.GetCurrentPrefabStage()} PrefabStage={PrefabStageUtility.GetPrefabStage(gameObject)}&quot;);</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span> </div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>                    <span class="comment">// get path from PrefabStage for this prefab</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="preprocessor">#if UNITY_2020_1_OR_NEWER</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>                    <span class="keywordtype">string</span> path = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">PrefabStageUtility</a>.GetPrefabStage(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>).assetPath;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>                    <span class="keywordtype">string</span> path = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">PrefabStageUtility</a>.GetPrefabStage(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>).prefabAssetPath;</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span> </div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignAssetID</a>(path);</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>                }</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>            }</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>            <span class="comment">// is this a scene object with prefab parent?</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Utils.IsSceneObjectWithPrefabParent(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">out</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">GameObject</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">prefab</a>))</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>            {</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignSceneID</a>();</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignAssetID</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">prefab</a>);</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>            }</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>            {</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">AssignSceneID</a>();</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span> </div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>                <span class="comment">// IMPORTANT: DO NOT clear assetId at runtime!</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>                <span class="comment">// =&gt; fixes a bug where clicking any of the NetworkIdentity</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>                <span class="comment">//    properties (like ServerOnly/ForceHidden) at runtime would</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>                <span class="comment">//    call OnValidate</span></div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>                <span class="comment">// =&gt; OnValidate gets into this else case here because prefab</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>                <span class="comment">//    connection isn&#39;t known at runtime</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>                <span class="comment">// =&gt; then we would clear the previously assigned assetId</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>                <span class="comment">// =&gt; and NetworkIdentity couldn&#39;t be spawned on other clients</span></div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>                <span class="comment">//    anymore because assetId was cleared</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>                <span class="keywordflow">if</span> (!<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">EditorApplication</a>.isPlaying)</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>                {</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>                    _assetId = 0;</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>                }</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>                <span class="comment">// don&#39;t log. would show a lot when pressing play in uMMORPG/uSurvival/etc.</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>                <span class="comment">//else Debug.Log($&quot;Avoided clearing assetId at runtime for {name} after (probably) clicking any of the NetworkIdentity properties.&quot;);</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>            }</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        }</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span> </div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>        <span class="comment">// OnDestroy is called for all SPAWNED NetworkIdentities</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        <span class="comment">// =&gt; scene objects aren&#39;t destroyed. it&#39;s not called for them.</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>        <span class="comment">//</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>        <span class="comment">// Note: Unity will Destroy all networked objects on Scene Change, so we</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>        <span class="comment">// have to handle that here silently. That means we cannot have any</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>        <span class="comment">// warning or logging in this method.</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>        <span class="keywordtype">void</span> OnDestroy()</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>        {</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>            <span class="comment">// Objects spawned from Instantiate are not allowed so are destroyed right away</span></div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>            <span class="comment">// we don&#39;t want to call NetworkServer.Destroy if this is the case</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a26902bfccbd86c890cebfc37bfc77d6d">SpawnedFromInstantiate</a>)</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span> </div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>            <span class="comment">// If false the object has already been unspawned</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>            <span class="comment">// if it is still true, then we need to unspawn it</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>            <span class="comment">// if destroy is already called don&#39;t call it again</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">isServer</a> &amp;&amp; !destroyCalled)</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>            {</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>                <span class="comment">// Do not add logging to this (see above)</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>                NetworkServer.Destroy(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">gameObject</a>);</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>            }</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span> </div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a7224507781dad1ac9cb724242cf3a653">isLocalPlayer</a>)</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>            {</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>                <span class="comment">// previously there was a bug where isLocalPlayer was</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>                <span class="comment">// false in OnDestroy because it was dynamically defined as:</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>                <span class="comment">//   isLocalPlayer =&gt; NetworkClient.localPlayer == this</span></div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>                <span class="comment">// we fixed it by setting isLocalPlayer manually and never</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>                <span class="comment">// resetting it.</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>                <span class="comment">//</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>                <span class="comment">// BUT now we need to be aware of a possible data race like in</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>                <span class="comment">// our rooms example:</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>                <span class="comment">// =&gt; GamePlayer is in world</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>                <span class="comment">// =&gt; player returns to room</span></div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>                <span class="comment">// =&gt; GamePlayer is destroyed</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>                <span class="comment">// =&gt; NetworkClient.localPlayer is set to RoomPlayer</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>                <span class="comment">// =&gt; GamePlayer.OnDestroy is called 1 frame later</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>                <span class="comment">// =&gt; GamePlayer.OnDestroy &#39;isLocalPlayer&#39; is true, so here we</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>                <span class="comment">//    are trying to clear NetworkClient.localPlayer</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>                <span class="comment">// =&gt; which would overwrite the new RoomPlayer local player</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>                <span class="comment">//</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>                <span class="comment">// FIXED by simply only clearing if NetworkClient.localPlayer</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>                <span class="comment">// still points to US!</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>                <span class="comment">// =&gt; see also: https://github.com/vis2k/Mirror/issues/2635</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>                <span class="keywordflow">if</span> (NetworkClient.localPlayer == <span class="keyword">this</span>)</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>                    NetworkClient.localPlayer = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>            }</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span> </div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a0a3bb71dd8fc37492957fe1bdbb7955e">isClient</a>)</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            {</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>                <span class="comment">// ServerChangeScene doesn&#39;t send destroy messages.</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>                <span class="comment">// some identities may persist in DDOL.</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>                <span class="comment">// some are destroyed by scene change.</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>                <span class="comment">// if an identity is still in .owned remove it.</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>                <span class="comment">// fixes: https://github.com/MirrorNetworking/Mirror/issues/3308</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>                <span class="keywordflow">if</span> (NetworkClient.connection != <span class="keyword">null</span>)</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>                    NetworkClient.connection.owned.Remove(<span class="keyword">this</span>);</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span> </div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>                <span class="comment">// if an identity is still in .spawned, remove it too.</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>                <span class="comment">// fixes: https://github.com/MirrorNetworking/Mirror/issues/3324</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>                NetworkClient.spawned.Remove(<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a3752b290380dc9ec029ddd86af8dc206">netId</a>);</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>            }</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        }</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span> </div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> OnStartServer()</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>        {</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>            {</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>                <span class="comment">// an exception in OnStartServer should be caught, so that one</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>                <span class="comment">// component&#39;s exception doesn&#39;t stop all other components from</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>                <span class="comment">// being initialized</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>                <span class="comment">// =&gt; this is what Unity does for Start() etc. too.</span></div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>                <span class="comment">//    one exception doesn&#39;t stop all the other Start() calls!</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>                <span class="keywordflow">try</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>                {</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.OnStartServer();</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>                }</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>                <span class="keywordflow">catch</span> (Exception <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>)</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>                {</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogException(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>);</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>                }</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>            }</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>        }</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> OnStopServer()</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>        {</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>            {</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>                <span class="comment">// an exception in OnStartServer should be caught, so that one</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>                <span class="comment">// component&#39;s exception doesn&#39;t stop all other components from</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>                <span class="comment">// being initialized</span></div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>                <span class="comment">// =&gt; this is what Unity does for Start() etc. too.</span></div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>                <span class="comment">//    one exception doesn&#39;t stop all the other Start() calls!</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>                <span class="keywordflow">try</span></div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>                {</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.OnStopServer();</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>                }</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>                <span class="keywordflow">catch</span> (Exception <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>)</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>                {</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogException(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>);</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>                }</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>            }</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>        }</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span> </div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> OnStartClient()</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>        {</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>            <span class="keywordflow">if</span> (clientStarted) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span> </div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>            clientStarted = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>            <span class="comment">// Debug.Log($&quot;OnStartClient {gameObject} netId:{netId}&quot;);</span></div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>            {</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>                <span class="comment">// an exception in OnStartClient should be caught, so that one</span></div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>                <span class="comment">// component&#39;s exception doesn&#39;t stop all other components from</span></div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>                <span class="comment">// being initialized</span></div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>                <span class="comment">// =&gt; this is what Unity does for Start() etc. too.</span></div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>                <span class="comment">//    one exception doesn&#39;t stop all the other Start() calls!</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>                <span class="keywordflow">try</span></div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>                {</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                    <span class="comment">// user implemented startup</span></div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.OnStartClient();</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>                }</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>                <span class="keywordflow">catch</span> (Exception <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>)</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>                {</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogException(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>);</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>                }</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>            }</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>        }</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span> </div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> OnStopClient()</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>        {</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>            <span class="comment">// In case this object was destroyed already don&#39;t call</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>            <span class="comment">// OnStopClient if OnStartClient hasn&#39;t been called.</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>            <span class="keywordflow">if</span> (!clientStarted) <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span> </div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>            {</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                <span class="comment">// an exception in OnStopClient should be caught, so that</span></div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>                <span class="comment">// one component&#39;s exception doesn&#39;t stop all other components</span></div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>                <span class="comment">// from being initialized</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>                <span class="comment">// =&gt; this is what Unity does for Start() etc. too.</span></div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>                <span class="comment">//    one exception doesn&#39;t stop all the other Start() calls!</span></div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>                <span class="keywordflow">try</span></div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>                {</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.OnStopClient();</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>                }</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>                <span class="keywordflow">catch</span> (Exception <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>)</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>                {</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogException(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>);</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>                }</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>            }</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>        }</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span> </div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        <span class="keyword">internal</span> <span class="keyword">static</span> <a class="code hl_class" href="class_mirror_1_1_network_identity.html">NetworkIdentity</a> previousLocalPlayer = <span class="keyword">null</span>;</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> OnStartLocalPlayer()</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>        {</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>            <span class="comment">// ensure OnStartLocalPlayer is only called once.</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>            <span class="comment">// Room demo would call it multiple times:</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>            <span class="comment">// - once from ApplySpawnPayload</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>            <span class="comment">// - once from OnObjectSpawnFinished</span></div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>            <span class="comment">//</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>            <span class="comment">// to reproduce:</span></div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>            <span class="comment">// - open room demo, add the 3 scenes to build settings</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>            <span class="comment">// - add OnStartLocalPlayer log to RoomPlayer prefab</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>            <span class="comment">// - build, run server-only</span></div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>            <span class="comment">// - in editor, connect, press ready</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>            <span class="comment">// - in server, start game</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>            <span class="comment">// - notice multiple OnStartLocalPlayer logs in editor client</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>            <span class="comment">//</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>            <span class="comment">// explanation:</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>            <span class="comment">// we send the spawn message multiple times. Whenever an object changes</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>            <span class="comment">// authority, we send the spawn message again for the object. This is</span></div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>            <span class="comment">// necessary because we need to reinitialize all variables when</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>            <span class="comment">// ownership change due to sync to owner feature.</span></div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>            <span class="comment">// Without this static, the second time we get the spawn message we</span></div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>            <span class="comment">// would call OnStartLocalPlayer again on the same object</span></div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>            <span class="keywordflow">if</span> (previousLocalPlayer == <span class="keyword">this</span>)</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>            previousLocalPlayer = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span> </div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>            {</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>                <span class="comment">// an exception in OnStartLocalPlayer should be caught, so that</span></div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>                <span class="comment">// one component&#39;s exception doesn&#39;t stop all other components</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>                <span class="comment">// from being initialized</span></div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>                <span class="comment">// =&gt; this is what Unity does for Start() etc. too.</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>                <span class="comment">//    one exception doesn&#39;t stop all the other Start() calls!</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>                <span class="keywordflow">try</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>                {</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.OnStartLocalPlayer();</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>                }</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>                <span class="keywordflow">catch</span> (Exception <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>)</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>                {</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogException(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>);</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                }</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>            }</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>        }</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> OnStopLocalPlayer()</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>        {</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>            {</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>                <span class="comment">// an exception in OnStopLocalPlayer should be caught, so that</span></div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>                <span class="comment">// one component&#39;s exception doesn&#39;t stop all other components</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>                <span class="comment">// from being initialized</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>                <span class="comment">// =&gt; this is what Unity does for Start() etc. too.</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>                <span class="comment">//    one exception doesn&#39;t stop all the other Start() calls!</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>                <span class="keywordflow">try</span></div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>                {</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.OnStopLocalPlayer();</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>                }</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>                <span class="keywordflow">catch</span> (Exception <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>)</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>                {</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogException(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>);</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>                }</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>            }</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        }</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span> </div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>        <span class="comment">// build dirty mask for server owner &amp; observers (= all dirty components).</span></div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>        <span class="comment">// faster to do it in one iteration instead of iterating separately.</span></div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>        (ulong, ulong) ServerDirtyMasks(<span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>)</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>        {</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerMask</a> = 0;</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>            ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observerMask</a> = 0;</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span> </div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>            <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a>[] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a> = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>;</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> = 0; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> &lt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>.Length; ++<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>)</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>            {</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>                <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> component = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>[<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>];</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span> </div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>                <span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">dirty</a> = component.<a class="code hl_function" href="class_mirror_1_1_network_behaviour.html#a76bf9eb3b49700f653620bbf5b7aa826">IsDirty</a>();</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>                ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">nthBit</a> = (1<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">u</a> &lt;&lt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>);</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span> </div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>                <span class="comment">// owner needs to be considered for both SyncModes, because</span></div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>                <span class="comment">// Observers mode always includes the Owner.</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>                <span class="comment">//</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>                <span class="comment">// for initial, it should always sync owner.</span></div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>                <span class="comment">// for delta, only for ServerToClient and only if dirty.</span></div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>                <span class="comment">//     ClientToServer comes from the owner client.</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>                <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a> || (component.<a class="code hl_variable" href="class_mirror_1_1_network_behaviour.html#a3e6dfe7de8eac46346abcc3153c6a0c8">syncDirection</a> == <a class="code hl_enumeration" href="namespace_mirror.html#a3a4f3784dd23e16377d46532b14bae88">SyncDirection</a>.ServerToClient &amp;&amp; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">dirty</a>))</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerMask</a> |= <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">nthBit</a>;</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span> </div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>                <span class="comment">// observers need to be considered only in Observers mode</span></div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>                <span class="comment">//</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>                <span class="comment">// for initial, it should always sync to observers.</span></div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>                <span class="comment">// for delta, only if dirty.</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>                <span class="comment">// SyncDirection is irrelevant, as both are broadcast to</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>                <span class="comment">// observers which aren&#39;t the owner.</span></div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>                <span class="keywordflow">if</span> (component.<a class="code hl_variable" href="class_mirror_1_1_network_behaviour.html#acf0616ac2f967bdd47bf0f579cefe8a7">syncMode</a> == <a class="code hl_enumeration" href="namespace_mirror.html#ac9acfe9461893a0d1ebc0eef63d1a6ff">SyncMode</a>.Observers &amp;&amp; (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a> || <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">dirty</a>))</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observerMask</a> |= <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">nthBit</a>;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>            }</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span> </div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>            <span class="keywordflow">return</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerMask</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observerMask</a>);</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>        }</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span> </div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>        <span class="comment">// build dirty mask for client.</span></div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>        <span class="comment">// server always knows initialState, so we don&#39;t need it here.</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        ulong ClientDirtyMask()</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>        {</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>            ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a> = 0;</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span> </div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>            <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a>[] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a> = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>;</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> = 0; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> &lt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>.Length; ++<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>)</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>            {</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>                <span class="comment">// on the client, we need to consider different sync scenarios:</span></div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>                <span class="comment">//</span></div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>                <span class="comment">//   ServerToClient SyncDirection:</span></div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>                <span class="comment">//     do nothing.</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>                <span class="comment">//   ClientToServer SyncDirection:</span></div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>                <span class="comment">//     serialize only if owned.</span></div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span> </div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                <span class="comment">// on client, only consider owned components with SyncDirection to server</span></div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>                <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> component = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>[<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>];</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>                <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a91ce5068c8b40a1479fe0e6cd7ea9a17">isOwned</a> &amp;&amp; component.<a class="code hl_variable" href="class_mirror_1_1_network_behaviour.html#a3e6dfe7de8eac46346abcc3153c6a0c8">syncDirection</a> == <a class="code hl_enumeration" href="namespace_mirror.html#a3a4f3784dd23e16377d46532b14bae88">SyncDirection</a>.ClientToServer)</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>                {</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>                    <span class="comment">// set the n-th bit if dirty</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>                    <span class="comment">// shifting from small to large numbers is varint-efficient.</span></div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>                    <span class="keywordflow">if</span> (component.<a class="code hl_function" href="class_mirror_1_1_network_behaviour.html#a76bf9eb3b49700f653620bbf5b7aa826">IsDirty</a>()) <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a> |= (1<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">u</a> &lt;&lt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>);</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>                }</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>            }</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span> </div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>            <span class="keywordflow">return</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a>;</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        }</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span> </div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        <span class="comment">// check if n-th component is dirty.</span></div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        <span class="comment">// in other words, if it has the n-th bit set in the dirty mask.</span></div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>        [<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">MethodImpl</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">MethodImplOptions</a>.AggressiveInlining)]</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>        <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> IsDirty(ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a>, <span class="keywordtype">int</span> index)</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>        {</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>            ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">nthBit</a> = (ulong)(1 &lt;&lt; index);</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>            <span class="keywordflow">return</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a> &amp; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">nthBit</a>) != 0;</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>        }</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span> </div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>        <span class="comment">// serialize components into writer on the server.</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>        <span class="comment">// check ownerWritten/observersWritten to know if anything was written</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>        <span class="comment">// We pass dirtyComponentsMask into this function so that we can check</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>        <span class="comment">// if any Components are dirty before creating writers</span></div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> SerializeServer(<span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>, <a class="code hl_class" href="class_mirror_1_1_network_writer.html">NetworkWriter</a> ownerWriter, <a class="code hl_class" href="class_mirror_1_1_network_writer.html">NetworkWriter</a> observersWriter)</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>        {</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>            <span class="comment">// ensure NetworkBehaviours are valid before usage</span></div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>            ValidateComponents();</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>            <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a>[] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a> = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>;</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span> </div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>            <span class="comment">// check which components are dirty for owner / observers.</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>            <span class="comment">// this is quite complicated with SyncMode + SyncDirection.</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>            <span class="comment">// see the function for explanation.</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>            <span class="comment">//</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>            <span class="comment">// instead of writing a 1 byte index per component,</span></div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>            <span class="comment">// we limit components to 64 bits and write one ulong instead.</span></div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>            <span class="comment">// the ulong is also varint compressed for minimum bandwidth.</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>            (ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerMask</a>, ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observerMask</a>) = ServerDirtyMasks(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span> </div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>            <span class="comment">// if nothing dirty, then don&#39;t even write the mask.</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>            <span class="comment">// otherwise, every unchanged object would send a 1 byte dirty mask!</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerMask</a> != 0) Compression.CompressVarUInt(ownerWriter, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerMask</a>);</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observerMask</a> != 0) Compression.CompressVarUInt(observersWriter, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observerMask</a>);</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span> </div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>            <span class="comment">// serialize all components</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>            <span class="comment">// perf: only iterate if either dirty mask has dirty bits.</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>            <span class="keywordflow">if</span> ((<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerMask</a> | <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observerMask</a>) != 0)</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>            {</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> = 0; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> &lt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>.Length; ++<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>)</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>                {</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>                    <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>[<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>];</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span> </div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>                    <span class="comment">// is the component dirty for anyone (owner or observers)?</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>                    <span class="comment">// may be serialized to owner, observer, both, or neither.</span></div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>                    <span class="comment">//</span></div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>                    <span class="comment">// OnSerialize should only be called once.</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>                    <span class="comment">// this is faster, and it cleaner because it may set</span></div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>                    <span class="comment">// internal state, counters, logs, etc.</span></div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>                    <span class="comment">//</span></div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>                    <span class="comment">// previously we always serialized to owner and then copied</span></div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>                    <span class="comment">// the serialization to observers. however, since</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>                    <span class="comment">// SyncDirection it&#39;s not guaranteed to be in owner anymore.</span></div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>                    <span class="comment">// so we need to serialize to temporary writer first.</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>                    <span class="comment">// and then copy as needed.</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>                    <span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerDirty</a> = IsDirty(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerMask</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>);</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>                    <span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observersDirty</a> = IsDirty(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observerMask</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>);</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>                    <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerDirty</a> || <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observersDirty</a>)</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>                    {</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>                        <span class="comment">// serialize into helper writer</span></div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>                        <span class="keyword">using</span> (<a class="code hl_class" href="class_mirror_1_1_network_writer_pooled.html">NetworkWriterPooled</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">temp</a> = NetworkWriterPool.Get())</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>                        {</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>                            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.Serialize(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">temp</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>);</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>                            <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ArraySegment&lt;byte&gt;</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">segment</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">temp</a>.ToArraySegment();</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span> </div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>                            <span class="comment">// copy to owner / observers as needed</span></div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>                            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">ownerDirty</a>) ownerWriter.<a class="code hl_function" href="class_mirror_1_1_network_writer.html#a321169a67b453a770a4c22d62bfc42ad">WriteBytes</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">segment</a>.Array, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">segment</a>.Offset, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">segment</a>.Count);</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>                            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">observersDirty</a>) observersWriter.<a class="code hl_function" href="class_mirror_1_1_network_writer.html#a321169a67b453a770a4c22d62bfc42ad">WriteBytes</a>(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">segment</a>.Array, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">segment</a>.Offset, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">segment</a>.Count);</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>                        }</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span> </div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>                        <span class="comment">// clear dirty bits for the components that we serialized.</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>                        <span class="comment">// do not clear for _all_ components, only the ones that</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>                        <span class="comment">// were dirty and had their syncInterval elapsed.</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>                        <span class="comment">//</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>                        <span class="comment">// we don&#39;t want to clear bits before the syncInterval</span></div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>                        <span class="comment">// was elapsed, as then they wouldn&#39;t be synced.</span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>                        <span class="comment">//</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>                        <span class="comment">// only clear for delta, not for full (spawn messages).</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>                        <span class="comment">// otherwise if a player joins, we serialize monster,</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>                        <span class="comment">// and shouldn&#39;t clear dirty bits not yet synced to</span></div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>                        <span class="comment">// other players.</span></div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>                        <span class="keywordflow">if</span> (!<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>) <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.ClearAllDirtyBits();</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>                    }</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>                }</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>            }</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>        }</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span> </div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>        <span class="comment">// serialize components into writer on the client.</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> SerializeClient(<a class="code hl_class" href="class_mirror_1_1_network_writer.html">NetworkWriter</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>)</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>        {</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>            <span class="comment">// ensure NetworkBehaviours are valid before usage</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>            ValidateComponents();</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>            <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a>[] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a> = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>;</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span> </div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>            <span class="comment">// check which components are dirty.</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>            <span class="comment">// this is quite complicated with SyncMode + SyncDirection.</span></div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>            <span class="comment">// see the function for explanation.</span></div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>            <span class="comment">//</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>            <span class="comment">// instead of writing a 1 byte index per component,</span></div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>            <span class="comment">// we limit components to 64 bits and write one ulong instead.</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>            <span class="comment">// the ulong is also varint compressed for minimum bandwidth.</span></div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>            ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">dirtyMask</a> = ClientDirtyMask();</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span> </div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>            <span class="comment">// varint compresses the mask to 1 byte in most cases.</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>            <span class="comment">// instead of writing an 8 byte ulong.</span></div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>            <span class="comment">//   7 components fit into 1 byte.  (previously  7 bytes)</span></div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>            <span class="comment">//  11 components fit into 2 bytes. (previously 11 bytes)</span></div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>            <span class="comment">//  16 components fit into 3 bytes. (previously 16 bytes)</span></div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>            <span class="comment">// TODO imer: server knows amount of comps, write N bytes instead</span></div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span> </div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>            <span class="comment">// if nothing dirty, then don&#39;t even write the mask.</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>            <span class="comment">// otherwise, every unchanged object would send a 1 byte dirty mask!</span></div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">dirtyMask</a> != 0) Compression.CompressVarUInt(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">dirtyMask</a>);</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span> </div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>            <span class="comment">// serialize all components</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>            <span class="comment">// perf: only iterate if dirty mask has dirty bits.</span></div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>            <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">dirtyMask</a> != 0)</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>            {</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>                <span class="comment">// serialize all components</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> = 0; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> &lt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>.Length; ++<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>)</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>                {</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>                    <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>[<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>];</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span> </div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>                    <span class="comment">// is this component dirty?</span></div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>                    <span class="comment">// reuse the mask instead of calling comp.IsDirty() again here.</span></div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>                    <span class="keywordflow">if</span> (IsDirty(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">dirtyMask</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>))</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>                    <span class="comment">// if (isOwned &amp;&amp; component.syncDirection == SyncDirection.ClientToServer)</span></div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>                    {</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>                        <span class="comment">// serialize into writer.</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>                        <span class="comment">// server always knows initialState, we never need to send it</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.Serialize(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">writer</a>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span> </div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>                        <span class="comment">// clear dirty bits for the components that we serialized.</span></div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>                        <span class="comment">// do not clear for _all_ components, only the ones that</span></div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>                        <span class="comment">// were dirty and had their syncInterval elapsed.</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>                        <span class="comment">//</span></div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>                        <span class="comment">// we don&#39;t want to clear bits before the syncInterval</span></div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>                        <span class="comment">// was elapsed, as then they wouldn&#39;t be synced.</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.ClearAllDirtyBits();</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>                    }</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>                }</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>            }</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        }</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span> </div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <span class="comment">// deserialize components from the client on the server.</span></div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        <span class="comment">// there&#39;s no &#39;initialState&#39;. server always knows the initial state.</span></div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>        <span class="keyword">internal</span> <span class="keywordtype">bool</span> DeserializeServer(<a class="code hl_class" href="class_mirror_1_1_network_reader.html">NetworkReader</a> reader)</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>        {</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>            <span class="comment">// ensure NetworkBehaviours are valid before usage</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>            ValidateComponents();</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>            <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a>[] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a> = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>;</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span> </div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>            <span class="comment">// first we deserialize the varinted dirty mask</span></div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>            ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a> = Compression.DecompressVarUInt(reader);</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span> </div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>            <span class="comment">// now deserialize every dirty component</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> = 0; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> &lt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>.Length; ++<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>)</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>            {</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>                <span class="comment">// was this one dirty?</span></div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>                <span class="keywordflow">if</span> (IsDirty(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>))</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>                {</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>                    <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>[<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>];</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span> </div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>                    <span class="comment">// safety check to ensure clients can only modify their own</span></div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>                    <span class="comment">// ClientToServer components, nothing else.</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>                    <span class="keywordflow">if</span> (<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.syncDirection == <a class="code hl_enumeration" href="namespace_mirror.html#a3a4f3784dd23e16377d46532b14bae88">SyncDirection</a>.ClientToServer)</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>                    {</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>                        <span class="comment">// deserialize this component</span></div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>                        <span class="comment">// server always knows the initial state (initial=false)</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>                        <span class="comment">// disconnect if failed, to prevent exploits etc.</span></div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>                        <span class="keywordflow">if</span> (!<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.Deserialize(reader, <span class="keyword">false</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>                        <span class="comment">// server received state from the owner client.</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>                        <span class="comment">// set dirty so it&#39;s broadcast to other clients too.</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>                        <span class="comment">//</span></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>                        <span class="comment">// note that we set the _whole_ component as dirty.</span></div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>                        <span class="comment">// everything will be broadcast to others.</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>                        <span class="comment">// SetSyncVarDirtyBits() would be nicer, but not all</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>                        <span class="comment">// components use [SyncVar]s.</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>                        <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.SetDirty();</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>                    }</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>                }</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>            }</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span> </div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>            <span class="comment">// successfully deserialized everything</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>        }</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span> </div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        <span class="comment">// deserialize components from server on the client.</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> DeserializeClient(<a class="code hl_class" href="class_mirror_1_1_network_reader.html">NetworkReader</a> reader, <span class="keywordtype">bool</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>)</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        {</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>            <span class="comment">// ensure NetworkBehaviours are valid before usage</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>            ValidateComponents();</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>            <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a>[] <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a> = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>;</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span> </div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>            <span class="comment">// first we deserialize the varinted dirty mask</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>            ulong <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a> = Compression.DecompressVarUInt(reader);</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span> </div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>            <span class="comment">// now deserialize every dirty component</span></div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> = 0; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a> &lt; <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>.Length; ++<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>)</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>            {</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>                <span class="comment">// was this one dirty?</span></div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>                <span class="keywordflow">if</span> (IsDirty(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">mask</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>))</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>                {</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>                    <span class="comment">// deserialize this component</span></div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>                    <a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> = <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">components</a>[<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">i</a>];</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.Deserialize(reader, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">initialState</a>);</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>                }</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>            }</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>        }</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span> </div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        <span class="comment">// get cached serialization for this tick (or serialize if none yet).</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        <span class="comment">// IMPORTANT: int tick avoids floating point inaccuracy over days/weeks.</span></div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>        <span class="comment">// calls SerializeServer, so this function is to be called on server.</span></div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>        <span class="keyword">internal</span> <a class="code hl_struct" href="struct_mirror_1_1_network_identity_serialization.html">NetworkIdentitySerialization</a> GetServerSerializationAtTick(<span class="keywordtype">int</span> tick)</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>        {</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>            <span class="comment">// only rebuild serialization once per tick. reuse otherwise.</span></div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>            <span class="comment">// except for tests, where Time.frameCount never increases.</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>            <span class="comment">// so during tests, we always rebuild.</span></div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>            <span class="comment">// (otherwise [SyncVar] changes would never be serialized in tests)</span></div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>            <span class="comment">//</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>            <span class="comment">// NOTE: != instead of &lt; because int.max+1 overflows at some point.</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>            <span class="keywordflow">if</span> (lastSerialization.<a class="code hl_variable" href="struct_mirror_1_1_network_identity_serialization.html#ad524e39c20b0ab0cd3571c058c3d2147">tick</a> != tick</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>#<span class="keywordflow">if</span> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">UNITY_EDITOR</a></div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>                || !<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Application</a>.isPlaying</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>#<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">endif</a></div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>               )</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>            {</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>                <span class="comment">// reset</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>                lastSerialization.ownerWriter.Position = 0;</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>                lastSerialization.observersWriter.Position = 0;</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span> </div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>                <span class="comment">// serialize</span></div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>                SerializeServer(<span class="keyword">false</span>,</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>                                lastSerialization.<a class="code hl_variable" href="struct_mirror_1_1_network_identity_serialization.html#a043b57d91ce42b27a090ac150c9549f8">ownerWriter</a>,</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>                                lastSerialization.<a class="code hl_variable" href="struct_mirror_1_1_network_identity_serialization.html#a1ca907f82f448de8d32d5e4d57252e96">observersWriter</a>);</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span> </div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>                <span class="comment">// set tick</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>                lastSerialization.tick = tick;</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>                <span class="comment">//Debug.Log($&quot;{name} (netId={netId}) serialized for tick={tickTimeStamp}&quot;);</span></div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>            }</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span> </div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>            <span class="comment">// return it</span></div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>            <span class="keywordflow">return</span> lastSerialization;</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>        }</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span> </div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> AddObserver(<a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> conn)</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        {</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">observers</a>.ContainsKey(conn.<a class="code hl_variable" href="class_mirror_1_1_network_connection.html#a1247800fa37e4af183ca3c58e687ecf4">connectionId</a>))</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>            {</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>                <span class="comment">// if we try to add a connectionId that was already added, then</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>                <span class="comment">// we may have generated one that was already in use.</span></div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>            }</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span> </div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>            <span class="comment">// Debug.Log($&quot;Added observer: {conn.address} added for {gameObject}&quot;);</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span> </div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>            <span class="comment">// if we previously had no observers, then clear all dirty bits once.</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>            <span class="comment">// a monster&#39;s health may have changed while it had no observers.</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>            <span class="comment">// but that change (= the dirty bits) don&#39;t matter as soon as the</span></div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>            <span class="comment">// first observer comes.</span></div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>            <span class="comment">// -&gt; first observer gets full spawn packet</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>            <span class="comment">// -&gt; afterwards it gets delta packet</span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>            <span class="comment">//    =&gt; if we don&#39;t clear previous dirty bits, observer would get</span></div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>            <span class="comment">//       the health change because the bit was still set.</span></div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>            <span class="comment">//    =&gt; ultimately this happens because spawn doesn&#39;t reset dirty</span></div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>            <span class="comment">//       bits</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>            <span class="comment">//    =&gt; which happens because spawn happens separately, instead of</span></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>            <span class="comment">//       in Broadcast() (which will be changed in the future)</span></div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>            <span class="comment">//</span></div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>            <span class="comment">// NOTE that NetworkServer.Broadcast previously cleared dirty bits</span></div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>            <span class="comment">//      for ALL SPAWNED that don&#39;t have observers. that was super</span></div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>            <span class="comment">//      expensive. doing it when adding the first observer has the</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>            <span class="comment">//      same result, without the O(N) iteration in Broadcast().</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>            <span class="comment">//</span></div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>            <span class="comment">// TODO remove this after moving spawning into Broadcast()!</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">observers</a>.Count == 0)</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>            {</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>                ClearAllComponentsDirtyBits();</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>            }</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span> </div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>            <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">observers</a>[conn.<a class="code hl_variable" href="class_mirror_1_1_network_connection.html#a1247800fa37e4af183ca3c58e687ecf4">connectionId</a>] = conn;</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>            conn.AddToObserving(<span class="keyword">this</span>);</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>        }</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span> </div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>        <span class="comment">// clear all component&#39;s dirty bits no matter what</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> ClearAllComponentsDirtyBits()</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>        {</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>            {</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.ClearAllDirtyBits();</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>            }</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>        }</div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span> </div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>        <span class="comment">// this is used when a connection is destroyed, since the &quot;observers&quot; property is read-only</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> RemoveObserver(<a class="code hl_class" href="class_network_connection.html">NetworkConnection</a> conn)</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>        {</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>            <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">observers</a>.Remove(conn.connectionId);</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>        }</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span> </div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>        <span class="comment">// This causes hasAuthority to be set on the client that owns the object,</span></div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>        <span class="comment">// and NetworkBehaviour.OnStartAuthority will be called on that client.</span></div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>        <span class="comment">// This object then will be in the NetworkConnection.clientOwnedObjects</span></div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>        <span class="comment">// list for the connection.</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>        <span class="comment">//</span></div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>        <span class="comment">// Authority can be removed with RemoveClientAuthority. Only one client</span></div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>        <span class="comment">// can own an object at any time. This does not need to be called for</span></div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>        <span class="comment">// player objects, as their authority is setup automatically.</span></div>
<div class="foldopen" id="foldopen01209" data-start="{" data-end="}">
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#abee3ebfdcdc4f85140f6d045c7e6f1fd"> 1209</a></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="class_mirror_1_1_network_identity.html#abee3ebfdcdc4f85140f6d045c7e6f1fd">AssignClientAuthority</a>(<a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> conn)</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>        {</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>            <span class="keywordflow">if</span> (!<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">isServer</a>)</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>            {</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<span class="stringliteral">&quot;AssignClientAuthority can only be called on the server for spawned objects.&quot;</span>);</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>            }</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span> </div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>            <span class="keywordflow">if</span> (conn == <span class="keyword">null</span>)</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>            {</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;AssignClientAuthority for {gameObject} owner cannot be null. Use RemoveClientAuthority() instead.&quot;</span>);</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>            }</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span> </div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a> != <span class="keyword">null</span> &amp;&amp; conn != <a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a>)</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>            {</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;AssignClientAuthority for {gameObject} already has an owner. Use RemoveClientAuthority() first.&quot;</span>);</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>            }</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span> </div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>            SetClientOwner(conn);</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span> </div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>            <span class="comment">// The client will match to the existing object</span></div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>            NetworkServer.SendChangeOwnerMessage(<span class="keyword">this</span>, conn);</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span> </div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>            <a class="code hl_event" href="class_mirror_1_1_network_identity.html#aba3975b546ad171d59ed0d4e0d15c3eb">clientAuthorityCallback</a>?.Invoke(conn, <span class="keyword">this</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span> </div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>        }</div>
</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>        <span class="comment">// used when adding players</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> SetClientOwner(<a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> conn)</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>        {</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>            <span class="comment">// do nothing if it already has an owner</span></div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a> != <span class="keyword">null</span> &amp;&amp; conn != <a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a>)</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>            {</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">$</a><span class="stringliteral">&quot;Object {this} netId={netId} already has an owner. Use RemoveClientAuthority() first&quot;</span>, <span class="keyword">this</span>);</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>            }</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span> </div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>            <span class="comment">// otherwise set the owner connection</span></div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a> = conn;</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>        }</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span> </div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>        <span class="comment">// Applies to objects that had authority set by AssignClientAuthority,</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>        <span class="comment">// or NetworkServer.Spawn with a NetworkConnection parameter included.</span></div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>        <span class="comment">// Authority cannot be removed for player objects.</span></div>
<div class="foldopen" id="foldopen01257" data-start="{" data-end="}">
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"><a class="line" href="class_mirror_1_1_network_identity.html#ab1c34c695ff0a05c3e81d2c530da822f"> 1257</a></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code hl_function" href="class_mirror_1_1_network_identity.html#ab1c34c695ff0a05c3e81d2c530da822f">RemoveClientAuthority</a>()</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>        {</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>            <span class="keywordflow">if</span> (!<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">isServer</a>)</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>            {</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<span class="stringliteral">&quot;RemoveClientAuthority can only be called on the server for spawned objects.&quot;</span>);</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>            }</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span> </div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a>?.identity == <span class="keyword">this</span>)</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>            {</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>                <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogError(<span class="stringliteral">&quot;RemoveClientAuthority cannot remove authority for a player object&quot;</span>);</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>            }</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span> </div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a> != <span class="keyword">null</span>)</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>            {</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>                <a class="code hl_event" href="class_mirror_1_1_network_identity.html#aba3975b546ad171d59ed0d4e0d15c3eb">clientAuthorityCallback</a>?.Invoke(<a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a>, <span class="keyword">this</span>, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>                <a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">previousOwner</a> = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a>;</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>                <a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a> = <span class="keyword">null</span>;</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>                NetworkServer.SendChangeOwnerMessage(<span class="keyword">this</span>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">previousOwner</a>);</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>            }</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>        }</div>
</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span> </div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>        <span class="comment">// Reset is called when the user hits the Reset button in the</span></div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>        <span class="comment">// Inspector&#39;s context menu or when adding the component the first time.</span></div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>        <span class="comment">// This function is only called in editor mode.</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>        <span class="comment">//</span></div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>        <span class="comment">// Reset() seems to be called only for Scene objects.</span></div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>        <span class="comment">// we can&#39;t destroy them (they are always in the scene).</span></div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>        <span class="comment">// instead we disable them and call Reset().</span></div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>        <span class="comment">//</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>        <span class="comment">// Do not reset SyncObjects from Reset</span></div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>        <span class="comment">// - Unspawned objects need to retain their list contents</span></div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>        <span class="comment">// - They may be respawned, especially players, but others as well.</span></div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>        <span class="comment">//</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>        <span class="comment">// OLD COMMENT:</span></div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>        <span class="comment">// Marks the identity for future reset, this is because we cant reset</span></div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>        <span class="comment">// the identity during destroy as people might want to be able to read</span></div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>        <span class="comment">// the members inside OnDestroy(), and we have no way of invoking reset</span></div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>        <span class="comment">// after OnDestroy is called.</span></div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> ResetState()</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>        {</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>            hasSpawned = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>            clientStarted = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a0a3bb71dd8fc37492957fe1bdbb7955e">isClient</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">isServer</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>            <span class="comment">//isLocalPlayer = false; &lt;- cleared AFTER ClearLocalPlayer below!</span></div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span> </div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>            <span class="comment">// remove authority flag. This object may be unspawned, not destroyed, on client.</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a91ce5068c8b40a1479fe0e6cd7ea9a17">isOwned</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>            NotifyAuthority();</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span> </div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a3752b290380dc9ec029ddd86af8dc206">netId</a> = 0;</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#afddec2dc92f3f98b1755937d9fd1430e">connectionToServer</a> = <span class="keyword">null</span>;</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">connectionToClient</a> = <span class="keyword">null</span>;</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span> </div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>            ClearObservers();</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span> </div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>            <span class="comment">// clear local player if it was the local player,</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>            <span class="comment">// THEN reset isLocalPlayer AFTERWARDS</span></div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>            <span class="keywordflow">if</span> (<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a7224507781dad1ac9cb724242cf3a653">isLocalPlayer</a>)</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>            {</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>                <span class="comment">// only clear NetworkClient.localPlayer IF IT POINTS TO US!</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>                <span class="comment">// see OnDestroy() comments. it does the same.</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>                <span class="comment">// (https://github.com/vis2k/Mirror/issues/2635)</span></div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>                <span class="keywordflow">if</span> (NetworkClient.localPlayer == <span class="keyword">this</span>)</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>                    NetworkClient.localPlayer = <span class="keyword">null</span>;</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>            }</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span> </div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>            previousLocalPlayer = <span class="keyword">null</span>;</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>            <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a7224507781dad1ac9cb724242cf3a653">isLocalPlayer</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>        }</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span> </div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>        <span class="keywordtype">bool</span> hadAuthority;</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> NotifyAuthority()</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>        {</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>            <span class="keywordflow">if</span> (!hadAuthority &amp;&amp; <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a91ce5068c8b40a1479fe0e6cd7ea9a17">isOwned</a>)</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>                OnStartAuthority();</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>            <span class="keywordflow">if</span> (hadAuthority &amp;&amp; !<a class="code hl_property" href="class_mirror_1_1_network_identity.html#a91ce5068c8b40a1479fe0e6cd7ea9a17">isOwned</a>)</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>                OnStopAuthority();</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>            hadAuthority = <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a91ce5068c8b40a1479fe0e6cd7ea9a17">isOwned</a>;</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>        }</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span> </div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> OnStartAuthority()</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>        {</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>            {</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>                <span class="comment">// an exception in OnStartAuthority should be caught, so that one</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>                <span class="comment">// component&#39;s exception doesn&#39;t stop all other components from</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>                <span class="comment">// being initialized</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>                <span class="comment">// =&gt; this is what Unity does for Start() etc. too.</span></div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>                <span class="comment">//    one exception doesn&#39;t stop all the other Start() calls!</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>                <span class="keywordflow">try</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>                {</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.OnStartAuthority();</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>                }</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>                <span class="keywordflow">catch</span> (Exception <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>)</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>                {</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogException(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>);</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>                }</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>            }</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>        }</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span> </div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> OnStopAuthority()</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>        {</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_behaviour.html">NetworkBehaviour</a> <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a> <span class="keywordflow">in</span> <a class="code hl_property" href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">NetworkBehaviours</a>)</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>            {</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>                <span class="comment">// an exception in OnStopAuthority should be caught, so that one</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>                <span class="comment">// component&#39;s exception doesn&#39;t stop all other components from</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>                <span class="comment">// being initialized</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>                <span class="comment">// =&gt; this is what Unity does for Start() etc. too.</span></div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>                <span class="comment">//    one exception doesn&#39;t stop all the other Start() calls!</span></div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>                <span class="keywordflow">try</span></div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>                {</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>.OnStopAuthority();</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>                }</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>                <span class="keywordflow">catch</span> (Exception <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>)</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>                {</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>                    <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">Debug</a>.LogException(<a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">e</a>, <a class="code hl_struct" href="struct_mirror_1_1_grid2_d.html">comp</a>);</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>                }</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>            }</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>        }</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span> </div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>        <span class="comment">// Called when NetworkIdentity is destroyed</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>        <span class="keyword">internal</span> <span class="keywordtype">void</span> ClearObservers()</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>        {</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>            <span class="keywordflow">foreach</span> (<a class="code hl_class" href="class_mirror_1_1_network_connection_to_client.html">NetworkConnectionToClient</a> conn <span class="keywordflow">in</span> <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">observers</a>.Values)</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>            {</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>                conn.RemoveFromObserving(<span class="keyword">this</span>, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>            }</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>            <a class="code hl_variable" href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">observers</a>.Clear();</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>        }</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>    }</div>
</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>}</div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html">Mirror.NetworkBehaviour</a></div><div class="ttdoc">Base class for networked components.</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00025">NetworkBehaviour.cs:26</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_a3e6dfe7de8eac46346abcc3153c6a0c8"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#a3e6dfe7de8eac46346abcc3153c6a0c8">Mirror.NetworkBehaviour.syncDirection</a></div><div class="ttdeci">SyncDirection syncDirection</div><div class="ttdoc">Sync direction for OnSerialize. ServerToClient by default. ClientToServer for client authority.</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00029">NetworkBehaviour.cs:29</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_a76bf9eb3b49700f653620bbf5b7aa826"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#a76bf9eb3b49700f653620bbf5b7aa826">Mirror.NetworkBehaviour.IsDirty</a></div><div class="ttdeci">bool IsDirty()</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_behaviour_html_acf0616ac2f967bdd47bf0f579cefe8a7"><div class="ttname"><a href="class_mirror_1_1_network_behaviour.html#acf0616ac2f967bdd47bf0f579cefe8a7">Mirror.NetworkBehaviour.syncMode</a></div><div class="ttdeci">SyncMode syncMode</div><div class="ttdoc">sync mode for OnSerialize</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00034">NetworkBehaviour.cs:34</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_connection_html"><div class="ttname"><a href="class_mirror_1_1_network_connection.html">Mirror.NetworkConnection</a></div><div class="ttdoc">Base NetworkConnection class for server-to-client and client-to-server connection.</div><div class="ttdef"><b>Definition</b> <a href="_mirror_2_core_2_network_connection_8cs_source.html#l00009">NetworkConnection.cs:10</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_connection_html_a1247800fa37e4af183ca3c58e687ecf4"><div class="ttname"><a href="class_mirror_1_1_network_connection.html#a1247800fa37e4af183ca3c58e687ecf4">Mirror.NetworkConnection.connectionId</a></div><div class="ttdeci">readonly int connectionId</div><div class="ttdoc">Unique identifier for this connection that is assigned by the transport layer.</div><div class="ttdef"><b>Definition</b> <a href="_mirror_2_core_2_network_connection_8cs_source.html#l00016">NetworkConnection.cs:16</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_connection_to_client_html"><div class="ttname"><a href="class_mirror_1_1_network_connection_to_client.html">Mirror.NetworkConnectionToClient</a></div><div class="ttdef"><b>Definition</b> <a href="_network_connection_to_client_8cs_source.html#l00008">NetworkConnectionToClient.cs:9</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html"><div class="ttname"><a href="class_mirror_1_1_network_identity.html">Mirror.NetworkIdentity</a></div><div class="ttdoc">NetworkIdentity identifies objects across the network.</div><div class="ttdef"><b>Definition</b> <a href="#l00041">NetworkIdentity.cs:42</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a030154e28b95e17a15de62707f0006e3"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a030154e28b95e17a15de62707f0006e3">Mirror.NetworkIdentity.GetSceneIdentity</a></div><div class="ttdeci">static NetworkIdentity GetSceneIdentity(ulong id)</div><div class="ttdoc">Gets the NetworkIdentity from the sceneIds dictionary with the corresponding id.</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a0a3bb71dd8fc37492957fe1bdbb7955e"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a0a3bb71dd8fc37492957fe1bdbb7955e">Mirror.NetworkIdentity.isClient</a></div><div class="ttdeci">bool isClient</div><div class="ttdoc">Returns true if running as a client and this object was spawned by a server.</div><div class="ttdef"><b>Definition</b> <a href="#l00055">NetworkIdentity.cs:55</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a26902bfccbd86c890cebfc37bfc77d6d"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a26902bfccbd86c890cebfc37bfc77d6d">Mirror.NetworkIdentity.SpawnedFromInstantiate</a></div><div class="ttdeci">bool SpawnedFromInstantiate</div><div class="ttdef"><b>Definition</b> <a href="#l00295">NetworkIdentity.cs:295</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a289174dce0c577d31030fadfeb08d8c9"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a289174dce0c577d31030fadfeb08d8c9">Mirror.NetworkIdentity.AssetGuidToUint</a></div><div class="ttdeci">static uint AssetGuidToUint(Guid guid)</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a2b90032cea75219737de4aab7ac8ecc6"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a2b90032cea75219737de4aab7ac8ecc6">Mirror.NetworkIdentity.serverOnly</a></div><div class="ttdeci">bool serverOnly</div><div class="ttdoc">Make this object only exist when the game is running as a server (or host).</div><div class="ttdef"><b>Definition</b> <a href="#l00163">NetworkIdentity.cs:163</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a32967ba9a8a00ebe0e39b897030f422e"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a32967ba9a8a00ebe0e39b897030f422e">Mirror.NetworkIdentity.observers</a></div><div class="ttdeci">readonly Dictionary&lt; int, NetworkConnectionToClient &gt; observers</div><div class="ttdoc">The set of network connections (players) that can see this object.</div><div class="ttdef"><b>Definition</b> <a href="#l00100">NetworkIdentity.cs:100</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a3752b290380dc9ec029ddd86af8dc206"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a3752b290380dc9ec029ddd86af8dc206">Mirror.NetworkIdentity.netId</a></div><div class="ttdeci">uint netId</div><div class="ttdoc">The unique network Id of this object (unique at runtime).</div><div class="ttdef"><b>Definition</b> <a href="#l00104">NetworkIdentity.cs:104</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a45b20df7d45211189befe124e3836f3c"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a45b20df7d45211189befe124e3836f3c">Mirror.NetworkIdentity.isServer</a></div><div class="ttdeci">bool isServer</div><div class="ttdoc">Returns true if NetworkServer.active and server is not stopped.</div><div class="ttdef"><b>Definition</b> <a href="#l00070">NetworkIdentity.cs:70</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a66d235276ea0ce252d2dff12e51cbcc0"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a66d235276ea0ce252d2dff12e51cbcc0">Mirror.NetworkIdentity.NetworkBehaviours</a></div><div class="ttdeci">NetworkBehaviour[] NetworkBehaviours</div><div class="ttdef"><b>Definition</b> <a href="#l00187">NetworkIdentity.cs:187</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a6caca6959f052d106e135e049e5a0fe6"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a6caca6959f052d106e135e049e5a0fe6">Mirror.NetworkIdentity.sceneId</a></div><div class="ttdeci">ulong sceneId</div><div class="ttdoc">Unique identifier for NetworkIdentity objects within a scene, used for spawning scene objects.</div><div class="ttdef"><b>Definition</b> <a href="#l00109">NetworkIdentity.cs:109</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a7224507781dad1ac9cb724242cf3a653"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a7224507781dad1ac9cb724242cf3a653">Mirror.NetworkIdentity.isLocalPlayer</a></div><div class="ttdeci">bool isLocalPlayer</div><div class="ttdoc">Return true if this object represents the player on the local machine.</div><div class="ttdef"><b>Definition</b> <a href="#l00084">NetworkIdentity.cs:84</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_a91ce5068c8b40a1479fe0e6cd7ea9a17"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#a91ce5068c8b40a1479fe0e6cd7ea9a17">Mirror.NetworkIdentity.isOwned</a></div><div class="ttdeci">bool isOwned</div><div class="ttdoc">isOwned is true on the client if this NetworkIdentity is one of the .owned entities of our connection...</div><div class="ttdef"><b>Definition</b> <a href="#l00094">NetworkIdentity.cs:94</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_aa04b8f2d8340b68f027b511e5fe86949"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#aa04b8f2d8340b68f027b511e5fe86949">Mirror.NetworkIdentity.assetId</a></div><div class="ttdeci">uint assetId</div><div class="ttdef"><b>Definition</b> <a href="#l00128">NetworkIdentity.cs:129</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_aa50d597abe0b493dcacbce7856b4f03a"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#aa50d597abe0b493dcacbce7856b4f03a">Mirror.NetworkIdentity.isServerOnly</a></div><div class="ttdeci">bool isServerOnly</div><div class="ttdoc">True if this object only exists on the server.</div><div class="ttdef"><b>Definition</b> <a href="#l00087">NetworkIdentity.cs:87</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_ab1c34c695ff0a05c3e81d2c530da822f"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#ab1c34c695ff0a05c3e81d2c530da822f">Mirror.NetworkIdentity.RemoveClientAuthority</a></div><div class="ttdeci">void RemoveClientAuthority()</div><div class="ttdoc">Removes ownership for an object.</div><div class="ttdef"><b>Definition</b> <a href="#l01257">NetworkIdentity.cs:1257</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_ab22c9e32ea015847c8d765d38b2620d4"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#ab22c9e32ea015847c8d765d38b2620d4">Mirror.NetworkIdentity.connectionToClient</a></div><div class="ttdeci">NetworkConnectionToClient connectionToClient</div><div class="ttdoc">Server's network connection to the client. This is only valid for client-owned objects (including the...</div><div class="ttdef"><b>Definition</b> <a href="#l00174">NetworkIdentity.cs:175</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_aba3975b546ad171d59ed0d4e0d15c3eb"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#aba3975b546ad171d59ed0d4e0d15c3eb">Mirror.NetworkIdentity.clientAuthorityCallback</a></div><div class="ttdeci">static ClientAuthorityCallback clientAuthorityCallback</div><div class="ttdoc">A callback that can be populated to be notified when the client-authority state of objects changes.</div><div class="ttdef"><b>Definition</b> <a href="#l00291">NetworkIdentity.cs:291</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_abee3ebfdcdc4f85140f6d045c7e6f1fd"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#abee3ebfdcdc4f85140f6d045c7e6f1fd">Mirror.NetworkIdentity.AssignClientAuthority</a></div><div class="ttdeci">bool AssignClientAuthority(NetworkConnectionToClient conn)</div><div class="ttdoc">Assign control of an object to a client via the client's NetworkConnection.</div><div class="ttdef"><b>Definition</b> <a href="#l01209">NetworkIdentity.cs:1209</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_ac5077f1ab1d5e360e1a4dd29b319f4d0"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#ac5077f1ab1d5e360e1a4dd29b319f4d0">Mirror.NetworkIdentity.isClientOnly</a></div><div class="ttdeci">bool isClientOnly</div><div class="ttdoc">True if this object exists on a client that is not also acting as a server.</div><div class="ttdef"><b>Definition</b> <a href="#l00090">NetworkIdentity.cs:90</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_acc43e5ce83c61b1dc738afe5ad3c6ef3"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#acc43e5ce83c61b1dc738afe5ad3c6ef3">Mirror.NetworkIdentity.visible</a></div><div class="ttdeci">Visibility visible</div><div class="ttdef"><b>Definition</b> <a href="#l00207">NetworkIdentity.cs:208</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_adc838564b39c994bd75cd40df9af1c1c"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#adc838564b39c994bd75cd40df9af1c1c">Mirror.NetworkIdentity.visibility</a></div><div class="ttdeci">Visibility visibility</div><div class="ttdef"><b>Definition</b> <a href="#l00202">NetworkIdentity.cs:202</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_aee37405a63cd24c7a2d5dedb752b918c"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#aee37405a63cd24c7a2d5dedb752b918c">Mirror.NetworkIdentity.ClientAuthorityCallback</a></div><div class="ttdeci">delegate void ClientAuthorityCallback(NetworkConnectionToClient conn, NetworkIdentity identity, bool authorityState)</div><div class="ttdoc">The delegate type for the clientAuthorityCallback.</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_af6af44b5090bf3d6e146440262b12d0f"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#af6af44b5090bf3d6e146440262b12d0f">Mirror.NetworkIdentity.ResetNextNetworkId</a></div><div class="ttdeci">static void ResetNextNetworkId()</div><div class="ttdoc">Resets nextNetworkId = 1.</div></div>
<div class="ttc" id="aclass_mirror_1_1_network_identity_html_afddec2dc92f3f98b1755937d9fd1430e"><div class="ttname"><a href="class_mirror_1_1_network_identity.html#afddec2dc92f3f98b1755937d9fd1430e">Mirror.NetworkIdentity.connectionToServer</a></div><div class="ttdeci">NetworkConnection connectionToServer</div><div class="ttdoc">Client's network connection to the server. This is only valid for player objects on the client.</div><div class="ttdef"><b>Definition</b> <a href="#l00171">NetworkIdentity.cs:171</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_reader_html"><div class="ttname"><a href="class_mirror_1_1_network_reader.html">Mirror.NetworkReader</a></div><div class="ttdoc">Network Reader for most simple types like floats, ints, buffers, structs, etc. Use NetworkReaderPool....</div><div class="ttdef"><b>Definition</b> <a href="_network_reader_8cs_source.html#l00018">NetworkReader.cs:19</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_writer_html"><div class="ttname"><a href="class_mirror_1_1_network_writer.html">Mirror.NetworkWriter</a></div><div class="ttdoc">Network Writer for most simple types like floats, ints, buffers, structs, etc. Use NetworkWriterPool....</div><div class="ttdef"><b>Definition</b> <a href="_network_writer_8cs_source.html#l00010">NetworkWriter.cs:11</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_writer_html_a321169a67b453a770a4c22d62bfc42ad"><div class="ttname"><a href="class_mirror_1_1_network_writer.html#a321169a67b453a770a4c22d62bfc42ad">Mirror.NetworkWriter.WriteBytes</a></div><div class="ttdeci">void WriteBytes(byte[] array, int offset, int count)</div><div class="ttdef"><b>Definition</b> <a href="_network_writer_8cs_source.html#l00194">NetworkWriter.cs:194</a></div></div>
<div class="ttc" id="aclass_mirror_1_1_network_writer_pooled_html"><div class="ttname"><a href="class_mirror_1_1_network_writer_pooled.html">Mirror.NetworkWriterPooled</a></div><div class="ttdoc">Pooled NetworkWriter, automatically returned to pool when using 'using'.</div><div class="ttdef"><b>Definition</b> <a href="_network_writer_pooled_8cs_source.html#l00009">NetworkWriterPooled.cs:10</a></div></div>
<div class="ttc" id="aclass_network_connection_html"><div class="ttname"><a href="class_network_connection.html">NetworkConnection</a></div><div class="ttdef"><b>Definition</b> <a href="_scripts_2_networking_2_network_connection_8cs_source.html#l00010">NetworkConnection.cs:11</a></div></div>
<div class="ttc" id="anamespace_mirror_1_1_remote_calls_html"><div class="ttname"><a href="namespace_mirror_1_1_remote_calls.html">Mirror.RemoteCalls</a></div><div class="ttdef"><b>Definition</b> <a href="_remote_calls_8cs_source.html#l00005">RemoteCalls.cs:6</a></div></div>
<div class="ttc" id="anamespace_mirror_1_1_remote_calls_html_aa6f151e63d93761510b1a8fffc797bfb"><div class="ttname"><a href="namespace_mirror_1_1_remote_calls.html#aa6f151e63d93761510b1a8fffc797bfb">Mirror.RemoteCalls.RemoteCallType</a></div><div class="ttdeci">RemoteCallType</div><div class="ttdef"><b>Definition</b> <a href="_remote_calls_8cs_source.html#l00008">RemoteCalls.cs:8</a></div></div>
<div class="ttc" id="anamespace_mirror_html"><div class="ttname"><a href="namespace_mirror.html">Mirror</a></div><div class="ttdef"><b>Definition</b> <a href="_basic_authenticator_8cs_source.html#l00005">BasicAuthenticator.cs:6</a></div></div>
<div class="ttc" id="anamespace_mirror_html_a3a4f3784dd23e16377d46532b14bae88"><div class="ttname"><a href="namespace_mirror.html#a3a4f3784dd23e16377d46532b14bae88">Mirror.SyncDirection</a></div><div class="ttdeci">SyncDirection</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00019">NetworkBehaviour.cs:19</a></div></div>
<div class="ttc" id="anamespace_mirror_html_a5c8e813ccf3860ffd43bf3a7bda88e3d"><div class="ttname"><a href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3d">Mirror.Visibility</a></div><div class="ttdeci">Visibility</div><div class="ttdef"><b>Definition</b> <a href="#l00024">NetworkIdentity.cs:24</a></div></div>
<div class="ttc" id="anamespace_mirror_html_a5c8e813ccf3860ffd43bf3a7bda88e3da78465833955440db1dedfdcc22b526a5"><div class="ttname"><a href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3da78465833955440db1dedfdcc22b526a5">Mirror.Visibility.ForceHidden</a></div><div class="ttdeci">@ ForceHidden</div></div>
<div class="ttc" id="anamespace_mirror_html_a5c8e813ccf3860ffd43bf3a7bda88e3da7a1920d61156abc05a60135aefe8bc67"><div class="ttname"><a href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3da7a1920d61156abc05a60135aefe8bc67">Mirror.Visibility.Default</a></div><div class="ttdeci">@ Default</div></div>
<div class="ttc" id="anamespace_mirror_html_a5c8e813ccf3860ffd43bf3a7bda88e3daa064898d00f046114c4b0e0d4c122fad"><div class="ttname"><a href="namespace_mirror.html#a5c8e813ccf3860ffd43bf3a7bda88e3daa064898d00f046114c4b0e0d4c122fad">Mirror.Visibility.ForceShown</a></div><div class="ttdeci">@ ForceShown</div></div>
<div class="ttc" id="anamespace_mirror_html_ac9acfe9461893a0d1ebc0eef63d1a6ff"><div class="ttname"><a href="namespace_mirror.html#ac9acfe9461893a0d1ebc0eef63d1a6ff">Mirror.SyncMode</a></div><div class="ttdeci">SyncMode</div><div class="ttdef"><b>Definition</b> <a href="_network_behaviour_8cs_source.html#l00010">NetworkBehaviour.cs:10</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_grid2_d_html"><div class="ttname"><a href="struct_mirror_1_1_grid2_d.html">Mirror.Grid2D</a></div><div class="ttdef"><b>Definition</b> <a href="_grid2_d_8cs_source.html#l00010">Grid2D.cs:11</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_network_identity_serialization_html"><div class="ttname"><a href="struct_mirror_1_1_network_identity_serialization.html">Mirror.NetworkIdentitySerialization</a></div><div class="ttdef"><b>Definition</b> <a href="#l00026">NetworkIdentity.cs:27</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_network_identity_serialization_html_a043b57d91ce42b27a090ac150c9549f8"><div class="ttname"><a href="struct_mirror_1_1_network_identity_serialization.html#a043b57d91ce42b27a090ac150c9549f8">Mirror.NetworkIdentitySerialization.ownerWriter</a></div><div class="ttdeci">NetworkWriter ownerWriter</div><div class="ttdef"><b>Definition</b> <a href="#l00030">NetworkIdentity.cs:30</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_network_identity_serialization_html_a1ca907f82f448de8d32d5e4d57252e96"><div class="ttname"><a href="struct_mirror_1_1_network_identity_serialization.html#a1ca907f82f448de8d32d5e4d57252e96">Mirror.NetworkIdentitySerialization.observersWriter</a></div><div class="ttdeci">NetworkWriter observersWriter</div><div class="ttdef"><b>Definition</b> <a href="#l00031">NetworkIdentity.cs:31</a></div></div>
<div class="ttc" id="astruct_mirror_1_1_network_identity_serialization_html_ad524e39c20b0ab0cd3571c058c3d2147"><div class="ttname"><a href="struct_mirror_1_1_network_identity_serialization.html#ad524e39c20b0ab0cd3571c058c3d2147">Mirror.NetworkIdentitySerialization.tick</a></div><div class="ttdeci">int tick</div><div class="ttdef"><b>Definition</b> <a href="#l00029">NetworkIdentity.cs:29</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_84bbf7b3c7f28a5a18725745e1505219.html">Assets</a></li><li class="navelem"><a class="el" href="dir_bf1dd3994e8f933eb733da65a1863113.html">Mirror</a></li><li class="navelem"><a class="el" href="dir_498e799cc6e42a51607844cb305aca07.html">Core</a></li><li class="navelem"><a class="el" href="_network_identity_8cs.html">NetworkIdentity.cs</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
